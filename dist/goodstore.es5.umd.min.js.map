{"version":3,"file":"goodstore.es5.umd.min.js","sources":["lib/CallerInternal.js","lib/CallerHandle.js","lib/DataStoreConsumable.js","lib/Dto/DataStoreRequestDto.js","lib/DataRow.js","lib/DataPage.js","lib/PageStore.js","lib/DataStore.js","lib/RequestConfig.js"],"sourcesContent":["import { Range2, Vec2 } from \"goodcore\";\r\nvar CallerInternal = (function () {\r\n    function CallerInternal(config, stream) {\r\n        this._fixedLoadPort = new Range2();\r\n        this._fixedPxLoadPort = new Range2();\r\n        this.totalCells = new Vec2(-1, -1);\r\n        this.totalPx = new Vec2(-1, -1);\r\n        this._config = config;\r\n        this._stream = stream;\r\n        this.fetchSubscription = null;\r\n        this.ignoreFetch = -1;\r\n        this.requestId = -1;\r\n    }\r\n    Object.defineProperty(CallerInternal.prototype, \"config\", {\r\n        get: function () {\r\n            return this._config;\r\n        },\r\n        set: function (v) {\r\n            this._config = v;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CallerInternal.prototype, \"stream\", {\r\n        get: function () {\r\n            return this._stream;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CallerInternal.prototype, \"loadPort\", {\r\n        get: function () {\r\n            return this.config.loadPort;\r\n        },\r\n        set: function (v) {\r\n            this.config.loadPort = v;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CallerInternal.prototype, \"pxLoadPort\", {\r\n        get: function () {\r\n            return this.config.pxLoadPort;\r\n        },\r\n        set: function (v) {\r\n            this.config.pxLoadPort = v;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CallerInternal.prototype, \"fixedLoadPort\", {\r\n        get: function () {\r\n            return this._fixedLoadPort;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CallerInternal.prototype, \"fixedPxLoadPort\", {\r\n        get: function () {\r\n            return this._fixedLoadPort;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CallerInternal.prototype, \"viewPort\", {\r\n        get: function () {\r\n            return this.config.viewPort;\r\n        },\r\n        set: function (v) {\r\n            if (!this.config.viewPort.equals(v)) {\r\n                this.ignoreOngoingFetch();\r\n            }\r\n            this.config.viewPort = v;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CallerInternal.prototype, \"pxViewPort\", {\r\n        get: function () {\r\n            return this.config.pxViewPort;\r\n        },\r\n        set: function (v) {\r\n            if (!this.config.pxViewPort.equals(v)) {\r\n                this.ignoreOngoingFetch();\r\n            }\r\n            this.config.pxViewPort = v;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    CallerInternal.prototype.fixLoadPort = function () {\r\n        if (this.config.pxLoadPort.isZero) {\r\n            this._fixedLoadPort.set(this.config.loadPort);\r\n            this._fixedPxLoadPort.zero();\r\n        }\r\n        else {\r\n            this._fixedPxLoadPort.set(this.config.pxLoadPort);\r\n            this._fixedLoadPort.zero();\r\n        }\r\n    };\r\n    CallerInternal.prototype.ignoreOngoingFetch = function () {\r\n        if (this.fetchSubscription !== null) {\r\n            this.ignoreFetch = this.requestId;\r\n        }\r\n    };\r\n    CallerInternal.prototype.cancelOngoingFetch = function () {\r\n        if (this.fetchSubscription !== null) {\r\n            this.fetchSubscription.unsubscribe();\r\n            this.fetchSubscription = null;\r\n        }\r\n    };\r\n    CallerInternal.prototype.limitLoadPortByTotalCells = function () {\r\n        this.limitPortByTotal(this.loadPort, this.totalCells);\r\n    };\r\n    CallerInternal.prototype.limitPxLoadPortByTotalPx = function () {\r\n        this.limitPortByTotal(this.pxLoadPort, this.totalPx);\r\n    };\r\n    CallerInternal.prototype.limitPortByTotal = function (port, total) {\r\n        if (!port.isZero && !total.equals({ x: -1, y: -1 })) {\r\n            var overflow = port.toRect().stop.subtract(total).max(new Vec2(0, 0));\r\n            port.size.subtract(overflow);\r\n        }\r\n    };\r\n    return CallerInternal;\r\n}());\r\nexport { CallerInternal };\r\n//# sourceMappingURL=CallerInternal.js.map","import { BehaviorSubject } from \"rxjs/BehaviorSubject\";\r\nimport { CallerInternal } from \"./CallerInternal\";\r\nvar CallerHandle = (function () {\r\n    function CallerHandle(id, store, config) {\r\n        this._force = false;\r\n        this._id = id;\r\n        this._store = store;\r\n        this._stream = new BehaviorSubject(null);\r\n        this._internal = new CallerInternal(config, this._stream);\r\n    }\r\n    Object.defineProperty(CallerHandle.prototype, \"internal\", {\r\n        get: function () {\r\n            return this._internal;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CallerHandle.prototype, \"stream\", {\r\n        get: function () {\r\n            return this._stream;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CallerHandle.prototype, \"viewPort\", {\r\n        get: function () {\r\n            return this._internal.viewPort;\r\n        },\r\n        set: function (v) {\r\n            this._internal.viewPort = v;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CallerHandle.prototype, \"pxViewPort\", {\r\n        get: function () {\r\n            return this._internal.pxViewPort;\r\n        },\r\n        set: function (v) {\r\n            this._internal.pxViewPort = v;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(CallerHandle.prototype, \"requestMargin\", {\r\n        get: function () {\r\n            return this._internal.config.requestMargin;\r\n        },\r\n        set: function (v) {\r\n            this._internal.config.requestMargin = v;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    CallerHandle.prototype.load = function (config) {\r\n        this.readConfig(config);\r\n        this._store.load(this.internal, this._force);\r\n    };\r\n    CallerHandle.prototype.unregister = function () {\r\n        throw new Error(\"not implemented\");\r\n    };\r\n    CallerHandle.prototype.readConfig = function (config) {\r\n        if (config !== undefined) {\r\n            if (config.requestMargin !== undefined) {\r\n                this.internal.config.requestMargin = config.requestMargin;\r\n            }\r\n            if (config.viewPort !== undefined) {\r\n                this.viewPort = config.viewPort;\r\n            }\r\n            if (config.pxViewPort !== undefined) {\r\n                this.pxViewPort = config.pxViewPort;\r\n            }\r\n            this._force = config.forceStream === true;\r\n        }\r\n    };\r\n    return CallerHandle;\r\n}());\r\nexport { CallerHandle };\r\n//# sourceMappingURL=CallerHandle.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nimport { Initable, Rect, Vec2 } from \"goodcore\";\r\nvar DataStoreConsumable = (function () {\r\n    function DataStoreConsumable() {\r\n        this.totalCells = new Vec2();\r\n        this.totalPx = new Vec2();\r\n        this.loadPort = null;\r\n        this.pxScope = new Rect();\r\n        this.rows = null;\r\n    }\r\n    DataStoreConsumable.prototype.init = function (obj) {\r\n        throw new Error(\"Method not implemented.\");\r\n    };\r\n    DataStoreConsumable = __decorate([\r\n        Initable\r\n    ], DataStoreConsumable);\r\n    return DataStoreConsumable;\r\n}());\r\nexport { DataStoreConsumable };\r\n//# sourceMappingURL=DataStoreConsumable.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nimport { Initable } from \"goodcore\";\r\nvar DataStoreRequestDto = (function () {\r\n    function DataStoreRequestDto() {\r\n    }\r\n    DataStoreRequestDto.prototype.init = function (obj) {\r\n        throw new Error(\"Method not implemented.\");\r\n    };\r\n    DataStoreRequestDto = __decorate([\r\n        Initable\r\n    ], DataStoreRequestDto);\r\n    return DataStoreRequestDto;\r\n}());\r\nexport { DataStoreRequestDto };\r\n//# sourceMappingURL=DataStoreRequestDto.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nimport { Initable, Poolable } from \"goodcore\";\r\nvar DataRow = (function () {\r\n    function DataRow(length) {\r\n        if (length === void 0) { length = 0; }\r\n        this.i = 0;\r\n        this.h = 0;\r\n        this.d = null;\r\n        this.c = new Array(length);\r\n    }\r\n    DataRow.prototype.init = function (obj) {\r\n        throw new Error(\"Method not implemented.\");\r\n    };\r\n    DataRow.prototype.release = function () {\r\n        throw new Error(\"Method not implemented.\");\r\n    };\r\n    DataRow.prototype.initPool = function (pool) {\r\n        throw new Error(\"Method not implemented.\");\r\n    };\r\n    DataRow = __decorate([\r\n        Poolable,\r\n        Initable,\r\n        __metadata(\"design:paramtypes\", [Number])\r\n    ], DataRow);\r\n    return DataRow;\r\n}());\r\nexport { DataRow };\r\n//# sourceMappingURL=DataRow.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nimport { Initable, Poolable, Rect, Vec2 } from \"goodcore\";\r\nimport { DataRow } from \"./DataRow\";\r\nvar DataPage = (function () {\r\n    function DataPage() {\r\n        this._id = 0;\r\n        this._r = [];\r\n        this._pxScope = new Rect();\r\n        this._cellSize = new Vec2();\r\n        this._r = new Array();\r\n    }\r\n    DataPage.prototype.release = function () {\r\n        throw new Error(\"Method not implemented.\");\r\n    };\r\n    DataPage.prototype.initPool = function (pool) {\r\n        throw new Error(\"Method not implemented.\");\r\n    };\r\n    Object.defineProperty(DataPage.prototype, \"id\", {\r\n        get: function () {\r\n            return this._id;\r\n        },\r\n        set: function (v) {\r\n            this._id = v;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(DataPage.prototype, \"r\", {\r\n        get: function () {\r\n            return this._r;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(DataPage.prototype, \"pxScope\", {\r\n        get: function () {\r\n            return this._pxScope;\r\n        },\r\n        set: function (v) {\r\n            this._pxScope.set(v);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(DataPage.prototype, \"cellSize\", {\r\n        get: function () {\r\n            return this._cellSize;\r\n        },\r\n        set: function (v) {\r\n            this._cellSize.set(v);\r\n            this.initData(v);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    DataPage.prototype.addRow = function () {\r\n        var result = new DataRow();\r\n        this._r.push(result);\r\n        return result;\r\n    };\r\n    DataPage.prototype.initData = function (size) {\r\n        var i = -1;\r\n        if (this._r === undefined) {\r\n            this._r = [];\r\n        }\r\n        var r = this._r;\r\n        var j = r.length - 1;\r\n        var k = Math.min(j, size.y);\r\n        while (++j < size.y) {\r\n            r.push(new DataRow(size.x));\r\n        }\r\n        if (r.length !== size.y) {\r\n            r.length = size.y;\r\n        }\r\n        while (++i < k) {\r\n            r[i].c.length = size.x;\r\n        }\r\n    };\r\n    DataPage = __decorate([\r\n        Poolable,\r\n        Initable,\r\n        __metadata(\"design:paramtypes\", [])\r\n    ], DataPage);\r\n    return DataPage;\r\n}());\r\nexport { DataPage };\r\n//# sourceMappingURL=DataPage.js.map","import { DataRow } from \"./DataRow\";\r\nimport { Arr, Dictionary, Pool, Range2, Rect, Util, Vec2 } from \"goodcore\";\r\nimport { DataPage } from \"./DataPage\";\r\nvar PageStore = (function () {\r\n    function PageStore(pageSize, retainSize, pagePxRanges) {\r\n        if (pagePxRanges === void 0) { pagePxRanges = null; }\r\n        this.isDebug = true;\r\n        this._usePx = true;\r\n        this._dummyRect = new Rect();\r\n        this._pagePool = new Pool(DataPage);\r\n        this._pageLookup = new Dictionary();\r\n        this._requestedPages = new Dictionary();\r\n        this._pageQueue = new Array();\r\n        this._cellsPerPage = new Vec2();\r\n        this._pagesPerCell = new Vec2();\r\n        this.setPageSize(pageSize);\r\n        this._retainSize = retainSize;\r\n        this._totalPages = new Vec2();\r\n        this._totalCells = new Vec2();\r\n        this._totalPx = new Vec2();\r\n        this._pagePxRanges = pagePxRanges;\r\n        this._usePx = pagePxRanges !== null;\r\n    }\r\n    Object.defineProperty(PageStore.prototype, \"totalPx\", {\r\n        get: function () {\r\n            return this._totalPx;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(PageStore.prototype, \"totalCells\", {\r\n        get: function () {\r\n            return this._totalCells;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(PageStore.prototype, \"totalPages\", {\r\n        get: function () {\r\n            return this._totalPages;\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    PageStore.prototype.setPageSize = function (v) {\r\n        if (!this._cellsPerPage.equals(v)) {\r\n            this.emptyPageStore();\r\n        }\r\n        this._cellsPerPage.set(v);\r\n        this._pagesPerCell.x = 1 / v.x;\r\n        this._pagesPerCell.y = 1 / v.y;\r\n    };\r\n    PageStore.prototype.isRequestedDataLoaded = function (caller) {\r\n        var _this = this;\r\n        var result = false;\r\n        var hasLoadPort = !caller.loadPort.isZero;\r\n        var hasPxLoadPort = !caller.pxLoadPort.isZero;\r\n        if (hasLoadPort || hasPxLoadPort) {\r\n            var pages = hasLoadPort ?\r\n                this.cellRangeToPageRange(caller.loadPort) :\r\n                this.pxRangeToPageRange(caller.pxLoadPort);\r\n            result = pages.first(function (p) { return !_this._pageLookup.has(p.y * _this._totalPages.x + p.x); }) === null;\r\n        }\r\n        return result;\r\n    };\r\n    PageStore.prototype.limitPagesToLoad = function (pageRange) {\r\n        var result = pageRange.clone();\r\n        var pages = pageRange.toRect();\r\n        var isNew = false;\r\n        for (var i = pages.start.y; i < pages.stop.y; i += 1) {\r\n            for (var j = pages.start.x; j < pages.stop.x; j += 1) {\r\n                if (!this._pageLookup.has(i * this._cellsPerPage.x + j)\r\n                    && !this._requestedPages.has(i * this._cellsPerPage.x + j)) {\r\n                    isNew = true;\r\n                    break;\r\n                }\r\n            }\r\n            if (isNew) {\r\n                break;\r\n            }\r\n            result.pos.y += 1;\r\n            result.size.y -= 1;\r\n        }\r\n        isNew = false;\r\n        for (var i = pages.stop.y; i > pages.start.y; i -= 1) {\r\n            for (var j = pages.start.x; j < pages.stop.x; j += 1) {\r\n                if (!this._pageLookup.has(i * this._cellsPerPage.x + j)\r\n                    && !this._requestedPages.has(i * this._cellsPerPage.x + j)) {\r\n                    isNew = true;\r\n                    break;\r\n                }\r\n            }\r\n            if (isNew) {\r\n                break;\r\n            }\r\n            result.size.y -= 1;\r\n        }\r\n        isNew = false;\r\n        for (var i = pages.start.x; i < pages.stop.x; i += 1) {\r\n            for (var j = pages.start.y; j < pages.stop.y; j += 1) {\r\n                if (!this._pageLookup.has(j * this._cellsPerPage.x + i)\r\n                    && !this._requestedPages.has(j * this._cellsPerPage.x + i)) {\r\n                    isNew = true;\r\n                    break;\r\n                }\r\n            }\r\n            if (isNew) {\r\n                break;\r\n            }\r\n            result.pos.x += 1;\r\n            result.size.x -= 1;\r\n        }\r\n        isNew = false;\r\n        for (var i = pages.stop.x; i > pages.start.x; i -= 1) {\r\n            for (var j = pages.start.y; j < pages.stop.y; j += 1) {\r\n                if (!this._pageLookup.has(j * this._cellsPerPage.x + i)\r\n                    && !this._requestedPages.has(j * this._cellsPerPage.x + i)) {\r\n                    isNew = true;\r\n                    break;\r\n                }\r\n            }\r\n            if (isNew) {\r\n                break;\r\n            }\r\n            result.size.x -= 1;\r\n        }\r\n        return result;\r\n    };\r\n    PageStore.prototype.cellSpaceToPageSpaceX = function (v) {\r\n        return (v / this._cellsPerPage.x) | 0;\r\n    };\r\n    PageStore.prototype.cellSpaceToPageSpaceY = function (v) {\r\n        return (v / this._cellsPerPage.y) | 0;\r\n    };\r\n    PageStore.prototype.cellSpaceToInnerPageSpaceX = function (v) {\r\n        return v - (this._cellsPerPage.x * this.cellSpaceToPageSpaceX(v));\r\n    };\r\n    PageStore.prototype.cellSpaceToInnerPageSpaceY = function (v) {\r\n        return v - (this._cellsPerPage.y * this.cellSpaceToPageSpaceY(v));\r\n    };\r\n    PageStore.prototype.pxRangeToPageRange = function (pixels) {\r\n        Util.assert(!!this._pagePxRanges.x && !!this._pagePxRanges.y, \"pagePxRanges does not contain valid ranges\");\r\n        var x1 = pixels.pos.x;\r\n        var pageX1 = Arr.binarySearch(this._pagePxRanges.x, function (el) {\r\n            return (el.p + el.s <= x1) ? -1 :\r\n                (el.p > x1) ? 1 :\r\n                    0;\r\n        });\r\n        var y1 = pixels.pos.y;\r\n        var pageY1 = Arr.binarySearch(this._pagePxRanges.y, function (el) {\r\n            return (el.p + el.s <= y1) ? -1 :\r\n                (el.p > y1) ? 1 :\r\n                    0;\r\n        });\r\n        var x2 = pixels.pos.x + pixels.size.x - 1;\r\n        var pageX2 = Arr.binarySearch(this._pagePxRanges.x, function (el) {\r\n            return (el.p + el.s <= x2) ? -1 :\r\n                (el.p > x2) ? 1 :\r\n                    0;\r\n        });\r\n        var y2 = pixels.pos.y + pixels.size.y - 1;\r\n        var pageY2 = Arr.binarySearch(this._pagePxRanges.y, function (el) {\r\n            return (el.p + el.s <= y2) ? -1 :\r\n                (el.p > y2) ? 1 :\r\n                    0;\r\n        });\r\n        var pages = new Rect(pageX1, pageY1, pageX2, pageY2, true).toRange2();\r\n        return pages;\r\n    };\r\n    PageStore.prototype.cellRangeToPageRange = function (cells) {\r\n        var pages = new Range2().set(cells);\r\n        var rect = pages.toRect(false, this._dummyRect).translate(this._pagesPerCell);\r\n        rect.start.toInt();\r\n        rect.stop.ceil();\r\n        rect.toRange2(pages);\r\n        return pages;\r\n    };\r\n    PageStore.prototype.pageRangeToCellRange = function (pages) {\r\n        return (new Range2()).set(pages).translate(this._cellsPerPage).toInt();\r\n    };\r\n    PageStore.prototype.pxRangeToCellRange = function (pixels) {\r\n        var pageRange = this.pxRangeToPageRange(pixels);\r\n        var pages = this.getDataPagesForPageRange(pageRange);\r\n        var pos = pages[0].pxScope.start.clone();\r\n        var indexX1 = 0;\r\n        Arr.until(pages[0].r[0].c, function (el, i) { return pixels.pos.x < pos.x + el.w; }, function (el, i) { pos.x += el.w; ++indexX1; });\r\n        var indexY1 = 0;\r\n        Arr.until(pages[0].r, function (el, i) { return pixels.pos.y < pos.y + el.h; }, function (el, i) { pos.y += el.h; ++indexY1; });\r\n        pos = pages[pages.length - 1].pxScope.start.clone();\r\n        var indexX2 = 0;\r\n        Arr.until(pages[pages.length - 1].r[0].c, function (el, i) { return pixels.pos.x + pixels.size.x - 1 < pos.x + el.w; }, function (el, i) { pos.x += el.w; ++indexX2; });\r\n        var indexY2 = 0;\r\n        Arr.until(pages[pages.length - 1].r, function (el, i) { return pixels.pos.y + pixels.size.y - 1 < pos.y + el.h; }, function (el, i) { pos.y += el.h; ++indexY2; });\r\n        var start = pages[0].r[indexY1].c[indexX1].i;\r\n        var stop = pages[pages.length - 1].r[indexY2].c[indexX2].i;\r\n        var result = new Rect(start.x, start.y, stop.x, stop.y, true).toRange2();\r\n        return result;\r\n    };\r\n    PageStore.prototype.addDataToPageStore = function (callers, payload) {\r\n        var _this = this;\r\n        var pages = this.partitionDataIntoPages(payload.r, payload.dataPort, payload.pxScope);\r\n        pages.forEach(function (p) { return _this.insertPage(p); });\r\n        this.cleanPageStore(callers);\r\n    };\r\n    PageStore.prototype.readPropertiesFromResponse = function (payload) {\r\n        if (!this._totalCells.equals(payload.totalCells)) {\r\n            this._totalPages.set(payload.totalCells).scale(this._pagesPerCell);\r\n            this._totalCells.set(payload.totalCells);\r\n            if (this._usePx) {\r\n                this._totalPx.set(payload.totalPx);\r\n            }\r\n        }\r\n    };\r\n    PageStore.prototype.emptyPageStore = function () {\r\n        while (this._pageQueue.length > 0) {\r\n            this.shiftPageQueue();\r\n        }\r\n    };\r\n    PageStore.prototype.cleanPageStore = function (callers) {\r\n        var _this = this;\r\n        var locked = this.calculateLockedPages(callers);\r\n        var retainCount = Math.max(this._retainSize, locked.list.count);\r\n        Arr.reverse(this._pageQueue);\r\n        Arr.reverseUntil(this._pageQueue, function (el, i) { return _this._pageQueue.length <= retainCount; }, function (el, i) {\r\n            if (!locked.has(\"\" + _this._pageQueue[i].id)) {\r\n                _this.removePageFromQueue(_this._pageQueue[i]);\r\n            }\r\n        });\r\n        Arr.reverse(this._pageQueue);\r\n    };\r\n    PageStore.prototype.removePageFromQueue = function (page) {\r\n        Arr.remove(this._pageQueue, page);\r\n        this.deletePageById(page.id);\r\n        page.release();\r\n    };\r\n    PageStore.prototype.shiftPageQueue = function () {\r\n        var toRemove = this._pageQueue.shift();\r\n        this.deletePageById(toRemove.id);\r\n        toRemove.release();\r\n    };\r\n    PageStore.prototype.deletePageById = function (pageId) {\r\n        var exists = this._pageLookup.has(pageId);\r\n        if (exists) {\r\n            this._pageLookup.delete(pageId);\r\n        }\r\n    };\r\n    PageStore.prototype.partitionDataIntoPages = function (data, cellPort, pxScope) {\r\n        var pageRect = this.cellRangeToPageRange(cellPort).toRect();\r\n        var result = new Array();\r\n        var pageCountY = 0;\r\n        for (var pageY = pageRect.start.y; pageY < pageRect.stop.y; ++pageY) {\r\n            var pageCountX = 0;\r\n            for (var pageX = pageRect.start.x; pageX < pageRect.stop.x; ++pageX) {\r\n                var id = (pageY * this._totalPages.x) + pageX;\r\n                var isNewPage = !this._pageLookup.has(id);\r\n                if (isNewPage) {\r\n                    var dataPage = this._pagePool.get();\r\n                    dataPage.id = id;\r\n                    dataPage.cellSize = this._cellsPerPage;\r\n                    if (this._usePx) {\r\n                        var pagePxX = this._pagePxRanges.x[pageX];\r\n                        var pagePxY = this._pagePxRanges.y[pageY];\r\n                        var pagePxScope = dataPage.pxScope;\r\n                        pagePxScope.start.x = pagePxX.p;\r\n                        pagePxScope.start.y = pagePxY.p;\r\n                        pagePxScope.stop.x = pagePxX.p + pagePxX.s - 1;\r\n                        pagePxScope.stop.y = pagePxY.p + pagePxY.s - 1;\r\n                    }\r\n                    result.push(dataPage);\r\n                    var dataStartY = pageCountY * this._cellsPerPage.y;\r\n                    var dataStartX = pageCountX * this._cellsPerPage.x;\r\n                    var dataLimitY = dataStartY + this._cellsPerPage.y;\r\n                    var dataLimitX = dataStartX + this._cellsPerPage.x;\r\n                    var pageRowNum = 0;\r\n                    for (var i = dataStartY; i < dataLimitY && i < data.length; ++i) {\r\n                        var row = data[i];\r\n                        var pageRow = dataPage.r[pageRowNum];\r\n                        pageRow.h = row.h;\r\n                        pageRow.i = row.i;\r\n                        pageRow.d = row.d;\r\n                        var pageColNum = 0;\r\n                        for (var j = dataStartX; j < dataLimitX && j < row.c.length; ++j) {\r\n                            pageRow.c[pageColNum] = row.c[j];\r\n                            ++pageColNum;\r\n                        }\r\n                        ++pageRowNum;\r\n                    }\r\n                }\r\n                ++pageCountX;\r\n            }\r\n            ++pageCountY;\r\n        }\r\n        return result;\r\n    };\r\n    PageStore.prototype.insertPage = function (page) {\r\n        var isNew = !this._pageLookup.has(page.id);\r\n        if (!isNew) {\r\n            Arr.removeOneByFn(this._pageQueue, function (el) {\r\n                return el.id === page.id;\r\n            });\r\n        }\r\n        this._pageQueue.push(page);\r\n        this._pageLookup.set(page.id, page);\r\n    };\r\n    PageStore.prototype.calculateLockedPages = function (callers) {\r\n        var _this = this;\r\n        var unique = new Dictionary();\r\n        Arr.forEach(Arr.flatten(Arr.map(callers, function (caller) {\r\n            return _this.getPageIdsForViewPort(caller.loadPort);\r\n        })), function (id) { return unique.set(id, id); });\r\n        return unique;\r\n    };\r\n    PageStore.prototype.assembleDataFromPages = function (caller) {\r\n        var result = new Array();\r\n        var loadPort = this.getLoadPort(caller);\r\n        Util.loop(loadPort.size.y, function (i) {\r\n            return result.push(new DataRow(loadPort.size.x));\r\n        });\r\n        var dataPages = this.getDataPages(caller);\r\n        var loadRect = loadPort.toRect();\r\n        var pageRange = this.cellRangeToPageRange(loadPort);\r\n        var viewSpace = new Vec2();\r\n        var modelSpace = new Vec2();\r\n        var pageSpace = new Vec2();\r\n        var innerPageSpace = new Vec2();\r\n        var dataPageNum;\r\n        var modelRowCount = result.length;\r\n        var modelColCount = result[0] === undefined ? 0 : result[0].c.length;\r\n        var relativePageSpace = new Vec2();\r\n        for (viewSpace.y = loadRect.start.y; viewSpace.y < loadRect.stop.y && modelSpace.y < modelRowCount; viewSpace.y += 1, modelSpace.y += 1) {\r\n            pageSpace.y = this.cellSpaceToPageSpaceY(viewSpace.y);\r\n            modelSpace.x = 0;\r\n            innerPageSpace.y = this.cellSpaceToInnerPageSpaceY(viewSpace.y);\r\n            relativePageSpace.set(pageSpace).subtract(pageRange.pos);\r\n            dataPageNum = relativePageSpace.y * pageRange.size.x + relativePageSpace.x;\r\n            var rowInfo = dataPages[dataPageNum].r[innerPageSpace.y];\r\n            result[modelSpace.y].init({ i: rowInfo.i, h: rowInfo.h, d: rowInfo.d });\r\n            for (viewSpace.x = loadRect.start.x; viewSpace.x < loadRect.stop.x && modelSpace.x < modelColCount; viewSpace.x += 1, modelSpace.x += 1) {\r\n                pageSpace.x = this.cellSpaceToPageSpaceX(viewSpace.x);\r\n                innerPageSpace.x = this.cellSpaceToInnerPageSpaceX(viewSpace.x);\r\n                innerPageSpace.y = this.cellSpaceToInnerPageSpaceY(viewSpace.y);\r\n                relativePageSpace.set(pageSpace).subtract(pageRange.pos);\r\n                dataPageNum = relativePageSpace.y * pageRange.size.x + relativePageSpace.x;\r\n                result[modelSpace.y].c[modelSpace.x] = dataPages[dataPageNum].r[innerPageSpace.y].c[innerPageSpace.x];\r\n            }\r\n        }\r\n        return result;\r\n    };\r\n    PageStore.prototype.getPageIdsForViewPort = function (viewPort) {\r\n        var _this = this;\r\n        var pages = this.cellRangeToPageRange(viewPort);\r\n        var result = [];\r\n        pages.forEach(function (p) {\r\n            var pos = p.y * _this._cellsPerPage.x + p.x;\r\n            if (_this._pageLookup.has(pos)) {\r\n                result.push(_this._pageLookup.get(pos).id);\r\n            }\r\n            return false;\r\n        });\r\n        return result;\r\n    };\r\n    PageStore.prototype.getLoadPort = function (caller) {\r\n        var byCells = !caller.loadPort.isZero;\r\n        return byCells ?\r\n            caller.loadPort :\r\n            this.pxRangeToCellRange(caller.pxLoadPort);\r\n    };\r\n    PageStore.prototype.getDataPages = function (caller) {\r\n        var byCells = !caller.loadPort.isZero;\r\n        return byCells ?\r\n            this.getDataPagesForCellPort(caller.loadPort) :\r\n            this.getDataPagesForPxPort(caller.pxLoadPort);\r\n    };\r\n    PageStore.prototype.getDataPagesForCellPort = function (port) {\r\n        var pages = this.cellRangeToPageRange(port);\r\n        return this.getDataPagesForPageRange(pages);\r\n    };\r\n    PageStore.prototype.getDataPagesForPxPort = function (port) {\r\n        var pages = this.pxRangeToPageRange(port);\r\n        return this.getDataPagesForPageRange(pages);\r\n    };\r\n    PageStore.prototype.getDataPagesForPageRange = function (pages) {\r\n        var _this = this;\r\n        var result = new Array();\r\n        pages.forEach(function (p) {\r\n            var pos = p.y * _this._totalPages.x + p.x;\r\n            if (_this._pageLookup.has(pos)) {\r\n                result.push(_this._pageLookup.get(pos));\r\n            }\r\n            return false;\r\n        });\r\n        return result;\r\n    };\r\n    return PageStore;\r\n}());\r\nexport { PageStore };\r\n//# sourceMappingURL=PageStore.js.map","import { Arr, Rect, Test, Util, Vec2 } from \"goodcore\";\r\nimport { CallerHandle } from \"./CallerHandle\";\r\nimport { DataStoreConsumable } from \"./DataStoreConsumable\";\r\nimport { DataStoreRequestDto } from \"./Dto/DataStoreRequestDto\";\r\nimport { PageStore } from \"./PageStore\";\r\nvar DataStore = (function () {\r\n    function DataStore(config) {\r\n        this.isDebug = true;\r\n        this._id = Util.newUUID();\r\n        this._usePx = true;\r\n        this._requestCounter = 0;\r\n        this._handleCounter = 0;\r\n        this._callers = [];\r\n        this._pageStore = null;\r\n        this._endPointFn = config.endPointFn ? config.endPointFn : DataStore.DEFAULT_CONFIG.endPointFn;\r\n        this._pageStore = new PageStore(config.pageSize || DataStore.DEFAULT_CONFIG.pageSize, config.retainSize ? config.retainSize : DataStore.DEFAULT_CONFIG.retainSize, config.pagePxRanges);\r\n    }\r\n    DataStore.prototype.load = function (caller, force) {\r\n        var _this = this;\r\n        if (force === void 0) { force = false; }\r\n        Util.assert(Test.isFunction(this._endPointFn), \"EndPoint is valid function\", this.isDebug);\r\n        Util.assert(caller.viewPort !== undefined, \"ViewPort is defined\", this.isDebug);\r\n        if (this.loadPortHasChanged(caller) || force) {\r\n            caller.limitLoadPortByTotalCells();\r\n            caller.limitPxLoadPortByTotalPx();\r\n            if (this._pageStore.isRequestedDataLoaded(caller)) {\r\n                this.addDataToStream(caller, force);\r\n                this._pageStore.cleanPageStore(this._callers);\r\n            }\r\n            else {\r\n                caller.fetchSubscription = this.fetchData(caller).subscribe(function (value) {\r\n                    if (!Util.assert(value !== undefined, \"Payload from server was empty in DataStore.load()\", _this.isDebug)) {\r\n                        return;\r\n                    }\r\n                    _this.readPropertiesFromResponse(caller, value);\r\n                    caller.limitLoadPortByTotalCells();\r\n                    caller.limitPxLoadPortByTotalPx();\r\n                    _this._pageStore.addDataToPageStore(_this._callers, value);\r\n                    if (caller.ignoreFetch < caller.requestId) {\r\n                        _this.addDataToStream(caller, force);\r\n                    }\r\n                }, function (error) {\r\n                    caller.cancelOngoingFetch();\r\n                    _this.onDataFail(caller, error);\r\n                });\r\n            }\r\n        }\r\n    };\r\n    DataStore.prototype.loadPortHasChanged = function (caller) {\r\n        var loadPort = caller.loadPort;\r\n        var pxLoadPort = caller.pxLoadPort;\r\n        return (!loadPort.isZero && !loadPort.equals(caller.fixedLoadPort)) ||\r\n            (!pxLoadPort.isZero && !pxLoadPort.equals(caller.fixedPxLoadPort));\r\n    };\r\n    DataStore.prototype.readPropertiesFromResponse = function (caller, value) {\r\n        caller.totalCells = new Vec2().set(value.totalCells);\r\n        this._usePx = !!value.pxScope;\r\n        if (this._usePx) {\r\n            caller.totalPx.set(value.totalPx);\r\n        }\r\n        if (value.cellsPerPage) {\r\n            this._pageStore.setPageSize(value.cellsPerPage);\r\n        }\r\n        this._pageStore.readPropertiesFromResponse(value);\r\n    };\r\n    DataStore.prototype.register = function (config) {\r\n        var result = new CallerHandle(this._handleCounter, this, config);\r\n        this._handleCounter += 1;\r\n        this._callers.push(result.internal);\r\n        return result;\r\n    };\r\n    DataStore.prototype.fetchData = function (caller) {\r\n        var dto = this.createRequestDTO(caller);\r\n        caller.requestId = this._requestCounter;\r\n        var data;\r\n        caller.cancelOngoingFetch();\r\n        return this._endPointFn(dto);\r\n    };\r\n    DataStore.prototype.createRequestDTO = function (caller) {\r\n        var pxRequest = null;\r\n        var cellRequest = null;\r\n        var pageRequest = null;\r\n        if (!caller.pxViewPort.isZero) {\r\n            pageRequest = this._pageStore.pxRangeToPageRange(caller.pxLoadPort);\r\n        }\r\n        else {\r\n            pageRequest = this._pageStore.cellRangeToPageRange(caller.loadPort);\r\n        }\r\n        pageRequest = this._pageStore.limitPagesToLoad(pageRequest);\r\n        cellRequest = this._pageStore.pageRangeToCellRange(pageRequest);\r\n        var result = new DataStoreRequestDto().init({\r\n            sourceId: this._id,\r\n            requestId: this._requestCounter,\r\n            cellRequest: cellRequest\r\n        });\r\n        this._requestCounter += 1;\r\n        return result;\r\n    };\r\n    DataStore.prototype.onDataFail = function (caller, reason) {\r\n        throw new Error(\"Not Implemented\");\r\n    };\r\n    DataStore.prototype.addDataToStream = function (caller, force) {\r\n        if (force === void 0) { force = false; }\r\n        if (!this.viewPortIsAlreadyStreamed(caller) || force) {\r\n            caller.fixLoadPort();\r\n            var loadPort = this._pageStore.getLoadPort(caller);\r\n            var rows = this._pageStore.assembleDataFromPages(caller);\r\n            var pxScope = null;\r\n            if (this._usePx) {\r\n                pxScope = this.calculatePxRangeFromCellRange(loadPort);\r\n            }\r\n            var result = new DataStoreConsumable();\r\n            result.init({ totalCells: this._pageStore.totalCells, totalPx: this._pageStore.totalPx, loadPort: loadPort, rows: rows, pxScope: pxScope });\r\n            caller.stream.next(result);\r\n        }\r\n    };\r\n    DataStore.prototype.viewPortIsAlreadyStreamed = function (caller) {\r\n        return (!caller.viewPort.isZero && caller.fixedLoadPort.contains(caller.viewPort)) ||\r\n            (!caller.pxViewPort.isZero && caller.fixedPxLoadPort.contains(caller.pxViewPort));\r\n    };\r\n    DataStore.prototype.calculatePxRangeFromCellRange = function (loadPort) {\r\n        var result = new Rect();\r\n        var dataPages = this._pageStore.getDataPagesForCellPort(loadPort);\r\n        var loadRect = loadPort.toRect();\r\n        var startPx = dataPages[0].pxScope.start.clone();\r\n        var stopPx = dataPages[dataPages.length - 1].pxScope.stop.clone();\r\n        var leftIndex = dataPages[0].r[0].c[0].i.x;\r\n        var rightIndex = dataPages[0].r[0].c[dataPages[0].r[0].c.length - 1].i.x;\r\n        var topIndex = dataPages[0].r[0].i;\r\n        var bottomIndex = dataPages[dataPages.length - 1].r[dataPages[dataPages.length - 1].r.length - 1].i;\r\n        var cells = Arr.shallowCopy(dataPages[0].r[0].c);\r\n        Arr.until(cells, function (cell, i) { return i + leftIndex >= loadRect.start.x; }, function (cell, i) { return startPx.x += cell.w; });\r\n        Arr.reverse(cells);\r\n        Arr.until(cells, function (cell, i) { return rightIndex - i >= loadRect.start.x; }, function (cell, i) { return stopPx.x -= cell.w; });\r\n        var rows = Arr.shallowCopy(dataPages[0].r);\r\n        Arr.until(rows, function (row, i) { return i + topIndex >= loadRect.start.y; }, function (row, i) { return startPx.y += row.h; });\r\n        Arr.reverse(rows);\r\n        Arr.until(rows, function (row, i) { return rightIndex - i >= loadRect.start.y; }, function (row, i) { return stopPx.y -= row.h; });\r\n        result.start = startPx;\r\n        result.stop = stopPx;\r\n        return result;\r\n    };\r\n    DataStore.DEFAULT_CONFIG = {\r\n        pageSize: new Vec2(10, 10),\r\n        retainSize: 10,\r\n        endPointFn: null\r\n    };\r\n    return DataStore;\r\n}());\r\nexport { DataStore };\r\n//# sourceMappingURL=DataStore.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nimport { Initable, Range2, Vec2 } from \"goodcore\";\r\nvar RequestConfig = (function () {\r\n    function RequestConfig() {\r\n        this._viewPort = new Range2();\r\n        this._pxViewPort = new Range2();\r\n        this._requestMargin = new Vec2(0, 0);\r\n        this._loadPort = new Range2();\r\n        this._pxLoadPort = new Range2();\r\n        this._pxRequestMargin = new Vec2(0, 0);\r\n    }\r\n    RequestConfig.prototype.init = function (obj) {\r\n        throw new Error(\"Method not implemented.\");\r\n    };\r\n    Object.defineProperty(RequestConfig.prototype, \"viewPort\", {\r\n        get: function () {\r\n            return this._viewPort;\r\n        },\r\n        set: function (v) {\r\n            this._viewPort.set(v);\r\n            this._loadPort = this.calculateLoadPort(this._viewPort, this._requestMargin);\r\n            this._pxViewPort.zero();\r\n            this._pxLoadPort.zero();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(RequestConfig.prototype, \"requestMargin\", {\r\n        get: function () {\r\n            return this._requestMargin;\r\n        },\r\n        set: function (v) {\r\n            this._requestMargin.set(v);\r\n            this._loadPort = this.calculateLoadPort(this._viewPort, this._requestMargin);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(RequestConfig.prototype, \"pxViewPort\", {\r\n        get: function () {\r\n            return this._pxViewPort;\r\n        },\r\n        set: function (v) {\r\n            this._pxViewPort.set(v);\r\n            this._pxLoadPort = this.calculateLoadPort(this._pxViewPort, this._pxRequestMargin);\r\n            this._viewPort.zero();\r\n            this._loadPort.zero();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(RequestConfig.prototype, \"pxRequestMargin\", {\r\n        get: function () {\r\n            return this._pxRequestMargin;\r\n        },\r\n        set: function (v) {\r\n            this._pxRequestMargin.set(v);\r\n            this._pxLoadPort = this.calculateLoadPort(this._pxViewPort, this._pxRequestMargin);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(RequestConfig.prototype, \"loadPort\", {\r\n        get: function () {\r\n            return this._loadPort;\r\n        },\r\n        set: function (v) {\r\n            this._loadPort.set(v);\r\n            this._pxLoadPort.zero();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    Object.defineProperty(RequestConfig.prototype, \"pxLoadPort\", {\r\n        get: function () {\r\n            return this._pxLoadPort;\r\n        },\r\n        set: function (v) {\r\n            this._pxLoadPort.set(v);\r\n            this._loadPort.zero();\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    RequestConfig.prototype.calculateLoadPort = function (viewPort, requestMargin) {\r\n        var result = viewPort.clone();\r\n        result.pos.subtract(requestMargin);\r\n        result.size.add(requestMargin.clone().multiply(2));\r\n        var underflow = result.pos.clone().invert().max({ x: 0, y: 0 });\r\n        result.pos.add(underflow);\r\n        result.size.subtract(underflow);\r\n        return result;\r\n    };\r\n    RequestConfig = __decorate([\r\n        Initable\r\n    ], RequestConfig);\r\n    return RequestConfig;\r\n}());\r\nexport { RequestConfig };\r\n//# sourceMappingURL=RequestConfig.js.map"],"names":["CallerInternal","config","stream","this","_fixedLoadPort","Range2","_fixedPxLoadPort","totalCells","Vec2","totalPx","_config","_stream","fetchSubscription","ignoreFetch","requestId","Object","defineProperty","prototype","get","set","v","enumerable","configurable","loadPort","pxLoadPort","viewPort","equals","ignoreOngoingFetch","pxViewPort","fixLoadPort","isZero","zero","cancelOngoingFetch","unsubscribe","limitLoadPortByTotalCells","limitPortByTotal","limitPxLoadPortByTotalPx","port","total","x","y","overflow","toRect","stop","subtract","max","size","CallerHandle","id","store","_force","_id","_store","BehaviorSubject","_internal","requestMargin","load","readConfig","internal","unregister","Error","undefined","forceStream","__decorate","decorators","target","key","desc","d","c","arguments","length","r","getOwnPropertyDescriptor","Reflect","decorate","i","DataStoreConsumable","pxScope","Rect","rows","init","obj","Initable","DataStoreRequestDto","__metadata","k","metadata","DataRow","h","Array","release","initPool","pool","Poolable","Number","DataPage","_r","_pxScope","_cellSize","initData","addRow","result","push","j","Math","min","PageStore","pageSize","retainSize","pagePxRanges","isDebug","_usePx","_dummyRect","_pagePool","Pool","_pageLookup","Dictionary","_requestedPages","_pageQueue","_cellsPerPage","_pagesPerCell","setPageSize","_retainSize","_totalPages","_totalCells","_totalPx","_pagePxRanges","emptyPageStore","isRequestedDataLoaded","caller","_this","hasLoadPort","hasPxLoadPort","cellRangeToPageRange","pxRangeToPageRange","first","p","has","limitPagesToLoad","pageRange","clone","pages","isNew","start","pos","cellSpaceToPageSpaceX","cellSpaceToPageSpaceY","cellSpaceToInnerPageSpaceX","cellSpaceToInnerPageSpaceY","pixels","Util","assert","x1","pageX1","Arr","binarySearch","el","s","y1","pageY1","x2","pageX2","y2","pageY2","toRange2","cells","rect","translate","toInt","ceil","pageRangeToCellRange","pxRangeToCellRange","getDataPagesForPageRange","indexX1","until","w","indexY1","indexX2","indexY2","addDataToPageStore","callers","payload","partitionDataIntoPages","dataPort","forEach","insertPage","cleanPageStore","readPropertiesFromResponse","scale","shiftPageQueue","locked","calculateLockedPages","retainCount","list","count","reverse","reverseUntil","removePageFromQueue","page","remove","deletePageById","toRemove","shift","pageId","delete","data","cellPort","pageRect","pageCountY","pageY","pageCountX","pageX","dataPage","cellSize","pagePxX","pagePxY","pagePxScope","dataStartY","dataStartX","dataLimitY","dataLimitX","pageRowNum","row","pageRow","pageColNum","removeOneByFn","unique","flatten","map","getPageIdsForViewPort","assembleDataFromPages","getLoadPort","loop","dataPageNum","dataPages","getDataPages","loadRect","viewSpace","modelSpace","pageSpace","innerPageSpace","modelRowCount","modelColCount","relativePageSpace","rowInfo","getDataPagesForCellPort","getDataPagesForPxPort","DataStore","newUUID","_requestCounter","_handleCounter","_callers","_pageStore","_endPointFn","endPointFn","DEFAULT_CONFIG","force","Test","isFunction","loadPortHasChanged","addDataToStream","fetchData","subscribe","value","error","onDataFail","fixedLoadPort","fixedPxLoadPort","cellsPerPage","register","dto","createRequestDTO","cellRequest","pageRequest","sourceId","reason","viewPortIsAlreadyStreamed","calculatePxRangeFromCellRange","next","contains","startPx","stopPx","leftIndex","rightIndex","topIndex","shallowCopy","cell","RequestConfig","_viewPort","_pxViewPort","_requestMargin","_loadPort","_pxLoadPort","_pxRequestMargin","calculateLoadPort","add","multiply","underflow","invert"],"mappings":"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"}