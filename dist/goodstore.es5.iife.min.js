var goodstore=function(e,t,r){"use strict";var o=function(){function e(e,r){this._fixedLoadPort=new t.Range2,this._fixedPxLoadPort=new t.Range2,this.totalCells=new t.Vec2(-1,-1),this.totalPx=new t.Vec2(-1,-1),this._config=e,this._stream=r,this.fetchSubscription=null,this.ignoreFetch=-1,this.requestId=-1}return Object.defineProperty(e.prototype,"config",{get:function(){return this._config},set:function(e){this._config=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stream",{get:function(){return this._stream},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadPort",{get:function(){return this.config.loadPort},set:function(e){this.config.loadPort=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pxLoadPort",{get:function(){return this.config.pxLoadPort},set:function(e){this.config.pxLoadPort=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fixedLoadPort",{get:function(){return this._fixedLoadPort},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fixedPxLoadPort",{get:function(){return this._fixedLoadPort},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewPort",{get:function(){return this.config.viewPort},set:function(e){this.config.viewPort.equals(e)||this.ignoreOngoingFetch(),this.config.viewPort=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pxViewPort",{get:function(){return this.config.pxViewPort},set:function(e){this.config.pxViewPort.equals(e)||this.ignoreOngoingFetch(),this.config.pxViewPort=e},enumerable:!0,configurable:!0}),e.prototype.fixLoadPort=function(){this.config.pxLoadPort.isZero?(this._fixedLoadPort.set(this.config.loadPort),this._fixedPxLoadPort.zero()):(this._fixedPxLoadPort.set(this.config.pxLoadPort),this._fixedLoadPort.zero())},e.prototype.ignoreOngoingFetch=function(){null!==this.fetchSubscription&&(this.ignoreFetch=this.requestId)},e.prototype.cancelOngoingFetch=function(){null!==this.fetchSubscription&&(this.fetchSubscription.unsubscribe(),this.fetchSubscription=null)},e.prototype.limitLoadPortByTotalCells=function(){this.limitPortByTotal(this.loadPort,this.totalCells)},e.prototype.limitPxLoadPortByTotalPx=function(){this.limitPortByTotal(this.pxLoadPort,this.totalPx)},e.prototype.limitPortByTotal=function(e,r){if(!e.isZero&&!r.equals({x:-1,y:-1})){var o=(new t.Rect).fromRange2(e).stop.subtract(r).max(new t.Vec2(0,0));e.size.subtract(o)}},e}(),n=function(){function e(e,t,n){this._force=!1,this._id=e,this._store=t,this._stream=new r.BehaviorSubject(null),this._internal=new o(n,this._stream)}return Object.defineProperty(e.prototype,"internal",{get:function(){return this._internal},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stream",{get:function(){return this._stream},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewPort",{get:function(){return this._internal.viewPort},set:function(e){this._internal.viewPort=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pxViewPort",{get:function(){return this._internal.pxViewPort},set:function(e){this._internal.pxViewPort=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"requestMargin",{get:function(){return this._internal.config.requestMargin},set:function(e){this._internal.config.requestMargin=e},enumerable:!0,configurable:!0}),e.prototype.load=function(e){this.readConfig(e),this._store.load(this.internal,this._force)},e.prototype.unregister=function(){throw new Error("not implemented")},e.prototype.readConfig=function(e){void 0!==e&&(void 0!==e.requestMargin&&(this.internal.config.requestMargin=e.requestMargin),void 0!==e.viewPort&&(this.viewPort=e.viewPort),void 0!==e.pxViewPort&&(this.pxViewPort=e.pxViewPort),this._force=!0===e.forceStream)},e}(),i=function(e,t,r,o){var n,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i<3?n(a):i>3?n(t,r,a):n(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},a=function(){function e(){this.totalCells=new t.Vec2,this.totalPx=new t.Vec2,this.loadPort=null,this.pxScope=new t.Rect,this.rows=null}return e.prototype.init=function(e,t){throw new Error("Method not implemented.")},e=i([t.Initable],e)}(),s=function(e,t,r,o){var n,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i<3?n(a):i>3?n(t,r,a):n(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},c=function(){function e(){this.sourceId="",this.requestId=0,this.cellRequest=null}return e.prototype.init=function(e,t){throw new Error("Method not implemented.")},e=s([t.Initable],e)}(),l=function(e,t,r,o){var n,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i<3?n(a):i>3?n(t,r,a):n(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},u=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e){void 0===e&&(e=0),this.i=0,this.h=0,this.d=null,this.c=new Array(e)}return e.prototype.release=function(){throw new Error("Method not implemented.")},e.prototype.initPool=function(e){throw new Error("Method not implemented.")},e.prototype.init=function(e,t){throw new Error("Method not implemented.")},e=l([t.Poolable,t.Initable,u("design:paramtypes",[Number])],e)}(),h=function(e,t,r,o){var n,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i<3?n(a):i>3?n(t,r,a):n(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},g=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(){this._id=0,this._r=[],this._pxScope=new t.Rect,this._cellSize=new t.Vec2,this._r=new Array}return e.prototype.init=function(e,t){throw new Error("Method not implemented.")},e.prototype.release=function(){throw new Error("Method not implemented.")},e.prototype.initPool=function(e){throw new Error("Method not implemented.")},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"r",{get:function(){return this._r},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pxScope",{get:function(){return this._pxScope},set:function(e){this._pxScope.set(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cellSize",{get:function(){return this._cellSize},set:function(e){this._cellSize.set(e),this.initData(e)},enumerable:!0,configurable:!0}),e.prototype.addRow=function(){var e=new p;return this._r.push(e),e},e.prototype.initData=function(e){var t=-1;void 0===this._r&&(this._r=[]);for(var r=this._r,o=r.length-1,n=Math.min(o,e.y);++o<e.y;)r.push(new p(e.x));for(r.length!==e.y&&(r.length=e.y);++t<n;)r[t].c.length=e.x},e=h([t.Poolable,t.Initable,g("design:paramtypes",[])],e)}(),P=function(){function e(e,r,o){void 0===o&&(o=null),this.isDebug=!0,this._usePx=!0,this._dummyRect=new t.Rect,this._pagePool=new t.Pool(f),this._pageLookup=new t.Dictionary,this._requestedPages=new t.Dictionary,this._pageQueue=new Array,this._cellsPerPage=new t.Vec2,this._pagesPerCell=new t.Vec2,this.setPageSize(e),this._retainSize=r,this._totalPages=new t.Vec2,this._totalCells=new t.Vec2,this._totalPx=new t.Vec2,this._pagePxRanges=o,this._usePx=null!==o}return Object.defineProperty(e.prototype,"totalPx",{get:function(){return this._totalPx},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalCells",{get:function(){return this._totalCells},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalPages",{get:function(){return this._totalPages},enumerable:!0,configurable:!0}),e.prototype.setPageSize=function(e){this._cellsPerPage.equals(e)||this.emptyPageStore(),this._cellsPerPage.set(e),this._pagesPerCell.x=1/e.x,this._pagesPerCell.y=1/e.y},e.prototype.isRequestedDataLoaded=function(e){var t=this,r=!1,o=!e.loadPort.isZero,n=!e.pxLoadPort.isZero;(o||n)&&(r=null===(o?this.cellRangeToPageRange(e.loadPort):this.pxRangeToPageRange(e.pxLoadPort)).first(function(e){return!t._pageLookup.has(e.y*t._totalPages.x+e.x)}));return r},e.prototype.limitPagesToLoad=function(e){for(var r=e.clone(),o=(new t.Rect).fromRange2(e),n=!1,i=o.start.y;i<o.stop.y;i+=1){for(var a=o.start.x;a<o.stop.x;a+=1)if(!this._pageLookup.has(i*this._cellsPerPage.x+a)&&!this._requestedPages.has(i*this._cellsPerPage.x+a)){n=!0;break}if(n)break;r.pos.y+=1,r.size.y-=1}n=!1;for(i=o.stop.y;i>o.start.y;i-=1){for(a=o.start.x;a<o.stop.x;a+=1)if(!this._pageLookup.has(i*this._cellsPerPage.x+a)&&!this._requestedPages.has(i*this._cellsPerPage.x+a)){n=!0;break}if(n)break;r.size.y-=1}n=!1;for(i=o.start.x;i<o.stop.x;i+=1){for(a=o.start.y;a<o.stop.y;a+=1)if(!this._pageLookup.has(a*this._cellsPerPage.x+i)&&!this._requestedPages.has(a*this._cellsPerPage.x+i)){n=!0;break}if(n)break;r.pos.x+=1,r.size.x-=1}n=!1;for(i=o.stop.x;i>o.start.x;i-=1){for(a=o.start.y;a<o.stop.y;a+=1)if(!this._pageLookup.has(a*this._cellsPerPage.x+i)&&!this._requestedPages.has(a*this._cellsPerPage.x+i)){n=!0;break}if(n)break;r.size.x-=1}return r},e.prototype.cellSpaceToPageSpaceX=function(e){return e/this._cellsPerPage.x|0},e.prototype.cellSpaceToPageSpaceY=function(e){return e/this._cellsPerPage.y|0},e.prototype.cellSpaceToInnerPageSpaceX=function(e){return e-this._cellsPerPage.x*this.cellSpaceToPageSpaceX(e)},e.prototype.cellSpaceToInnerPageSpaceY=function(e){return e-this._cellsPerPage.y*this.cellSpaceToPageSpaceY(e)},e.prototype.pxRangeToPageRange=function(e){t.Util.assert(!!this._pagePxRanges.x&&!!this._pagePxRanges.y,"pagePxRanges does not contain valid ranges");var r=e.pos.x,o=t.Arr.binarySearch(this._pagePxRanges.x,function(e){return e.p+e.s<=r?-1:e.p>r?1:0}),n=e.pos.y,i=t.Arr.binarySearch(this._pagePxRanges.y,function(e){return e.p+e.s<=n?-1:e.p>n?1:0}),a=e.pos.x+e.size.x-1,s=t.Arr.binarySearch(this._pagePxRanges.x,function(e){return e.p+e.s<=a?-1:e.p>a?1:0}),c=e.pos.y+e.size.y-1,l=t.Arr.binarySearch(this._pagePxRanges.y,function(e){return e.p+e.s<=c?-1:e.p>c?1:0});return(new t.Range2).fromRect(new t.Rect(o,i,s,l,!0))},e.prototype.cellRangeToPageRange=function(e){var r=(new t.Range2).set(e),o=this._dummyRect.fromRange2(r).translate(this._pagesPerCell);return o.start.toInt(),o.stop.ceil(),r.fromRect(o),r},e.prototype.pageRangeToCellRange=function(e){return(new t.Range2).set(e).translate(this._cellsPerPage).toInt()},e.prototype.pxRangeToCellRange=function(e){var r=this.pxRangeToPageRange(e),o=this.getDataPagesForPageRange(r),n=o[0].pxScope.start.clone(),i=0;t.Arr.until(o[0].r[0].c,function(t,r){return e.pos.x<n.x+t.w},function(e,t){n.x+=e.w,++i});var a=0;t.Arr.until(o[0].r,function(t,r){return e.pos.y<n.y+t.h},function(e,t){n.y+=e.h,++a}),n=o[o.length-1].pxScope.start.clone();var s=0;t.Arr.until(o[o.length-1].r[0].c,function(t,r){return e.pos.x+e.size.x-1<n.x+t.w},function(e,t){n.x+=e.w,++s});var c=0;t.Arr.until(o[o.length-1].r,function(t,r){return e.pos.y+e.size.y-1<n.y+t.h},function(e,t){n.y+=e.h,++c});var l=o[0].r[a].c[i].i,u=o[o.length-1].r[c].c[s].i;return(new t.Range2).fromRect(new t.Rect(l.x,l.y,u.x,u.y,!0))},e.prototype.addDataToPageStore=function(e,t){var r=this;this.partitionDataIntoPages(t.r,t.dataPort,t.pxScope).forEach(function(e){return r.insertPage(e)}),this.cleanPageStore(e)},e.prototype.readPropertiesFromResponse=function(e){this._totalCells.equals(e.totalCells)||(this._totalPages.set(e.totalCells).scale(this._pagesPerCell),this._totalCells.set(e.totalCells),this._usePx&&this._totalPx.set(e.totalPx))},e.prototype.emptyPageStore=function(){for(;this._pageQueue.length>0;)this.shiftPageQueue()},e.prototype.cleanPageStore=function(e){var r=this,o=this.calculateLockedPages(e),n=Math.max(this._retainSize,o.values.length);t.Arr.reverse(this._pageQueue),t.Arr.reverseUntil(this._pageQueue,function(e,t){return r._pageQueue.length<=n},function(e,t){o.has(""+r._pageQueue[t].id)||r.removePageFromQueue(r._pageQueue[t])}),t.Arr.reverse(this._pageQueue)},e.prototype.removePageFromQueue=function(e){t.Arr.remove(this._pageQueue,e),this.deletePageById(e.id),e.release()},e.prototype.shiftPageQueue=function(){var e=this._pageQueue.shift();this.deletePageById(e.id),e.release()},e.prototype.deletePageById=function(e){this._pageLookup.has(e)&&this._pageLookup.delete(e)},e.prototype.partitionDataIntoPages=function(e,r,o){for(var n=(new t.Rect).fromRange2(this.cellRangeToPageRange(r)),i=new Array,a=0,s=n.start.y;s<n.stop.y;++s){for(var c=0,l=n.start.x;l<n.stop.x;++l){var u=s*this._totalPages.x+l;if(!this._pageLookup.has(u)){var p=this._pagePool.get();if(p.id=u,p.cellSize=this._cellsPerPage,this._usePx){var h=this._pagePxRanges.x[l],g=this._pagePxRanges.y[s],f=p.pxScope;f.start.x=h.p,f.start.y=g.p,f.stop.x=h.p+h.s-1,f.stop.y=g.p+g.s-1}i.push(p);for(var P=a*this._cellsPerPage.y,d=c*this._cellsPerPage.x,y=P+this._cellsPerPage.y,x=d+this._cellsPerPage.x,_=0,w=P;w<y&&w<e.length;++w){var b=e[w],R=p.r[_];R.h=b.h,R.i=b.i,R.d=b.d;for(var m=0,v=d;v<x&&v<b.c.length;++v)R.c[m]=b.c[v],++m;++_}}++c}++a}return i},e.prototype.insertPage=function(e){!this._pageLookup.has(e.id)||t.Arr.removeOneByFn(this._pageQueue,function(t){return t.id===e.id}),this._pageQueue.push(e),this._pageLookup.set(e.id,e)},e.prototype.calculateLockedPages=function(e){var r=this,o=new t.Dictionary;return t.Arr.forEach(t.Arr.flatten(t.Arr.map(e,function(e){return r.getPageIdsForViewPort(e.loadPort)})),function(e){return o.set(e,e)}),o},e.prototype.assembleDataFromPages=function(e){var r=new Array,o=this.getLoadPort(e);t.Util.loop(o.size.y,function(e){return r.push(new p(o.size.x))});var n,i=this.getDataPages(e),a=(new t.Rect).fromRange2(o),s=this.cellRangeToPageRange(o),c=new t.Vec2,l=new t.Vec2,u=new t.Vec2,h=new t.Vec2,g=r.length,f=void 0===r[0]?0:r[0].c.length,P=new t.Vec2;for(c.y=a.start.y;c.y<a.stop.y&&l.y<g;c.y+=1,l.y+=1){u.y=this.cellSpaceToPageSpaceY(c.y),l.x=0,h.y=this.cellSpaceToInnerPageSpaceY(c.y),P.set(u).subtract(s.pos);var d=i[n=P.y*s.size.x+P.x].r[h.y];for(r[l.y].init({i:d.i,h:d.h,d:d.d}),c.x=a.start.x;c.x<a.stop.x&&l.x<f;c.x+=1,l.x+=1)u.x=this.cellSpaceToPageSpaceX(c.x),h.x=this.cellSpaceToInnerPageSpaceX(c.x),h.y=this.cellSpaceToInnerPageSpaceY(c.y),P.set(u).subtract(s.pos),n=P.y*s.size.x+P.x,r[l.y].c[l.x]=i[n].r[h.y].c[h.x]}return r},e.prototype.getPageIdsForViewPort=function(e){var t=this,r=[];return this.cellRangeToPageRange(e).forEach(function(e){var o=e.y*t._cellsPerPage.x+e.x;return t._pageLookup.has(o)&&r.push(t._pageLookup.get(o).id),!1}),r},e.prototype.getLoadPort=function(e){return!e.loadPort.isZero?e.loadPort:this.pxRangeToCellRange(e.pxLoadPort)},e.prototype.getDataPages=function(e){return!e.loadPort.isZero?this.getDataPagesForCellPort(e.loadPort):this.getDataPagesForPxPort(e.pxLoadPort)},e.prototype.getDataPagesForCellPort=function(e){var t=this.cellRangeToPageRange(e);return this.getDataPagesForPageRange(t)},e.prototype.getDataPagesForPxPort=function(e){var t=this.pxRangeToPageRange(e);return this.getDataPagesForPageRange(t)},e.prototype.getDataPagesForPageRange=function(e){var t=this,r=new Array;return e.forEach(function(e){var o=e.y*t._totalPages.x+e.x;return t._pageLookup.has(o)&&r.push(t._pageLookup.get(o)),!1}),r},e}(),d=function(){function e(r){this.isDebug=!0,this._id=t.Util.newUUID(),this._usePx=!0,this._requestCounter=0,this._handleCounter=0,this._callers=[],this._pageStore=null,this._endPointFn=r.endPointFn?r.endPointFn:e.DEFAULT_CONFIG.endPointFn,this._pageStore=new P(r.pageSize||e.DEFAULT_CONFIG.pageSize,r.retainSize?r.retainSize:e.DEFAULT_CONFIG.retainSize,r.pagePxRanges)}return e.prototype.load=function(e,r){var o=this;void 0===r&&(r=!1),t.Util.assert(t.Test.isFunction(this._endPointFn),"EndPoint is valid function",this.isDebug),t.Util.assert(void 0!==e.viewPort,"ViewPort is defined",this.isDebug),(this.loadPortHasChanged(e)||r)&&(e.limitLoadPortByTotalCells(),e.limitPxLoadPortByTotalPx(),this._pageStore.isRequestedDataLoaded(e)?(this.addDataToStream(e,r),this._pageStore.cleanPageStore(this._callers)):e.fetchSubscription=this.fetchData(e).subscribe(function(n){t.Util.assert(void 0!==n,"Payload from server was empty in DataStore.load()",o.isDebug)&&(o.readPropertiesFromResponse(e,n),e.limitLoadPortByTotalCells(),e.limitPxLoadPortByTotalPx(),o._pageStore.addDataToPageStore(o._callers,n),e.ignoreFetch<e.requestId&&o.addDataToStream(e,r))},function(t){e.cancelOngoingFetch(),o.onDataFail(e,t)}))},e.prototype.loadPortHasChanged=function(e){var t=e.loadPort,r=e.pxLoadPort;return!t.isZero&&!t.equals(e.fixedLoadPort)||!r.isZero&&!r.equals(e.fixedPxLoadPort)},e.prototype.readPropertiesFromResponse=function(e,r){e.totalCells=(new t.Vec2).set(r.totalCells),this._usePx=!!r.pxScope,this._usePx&&e.totalPx.set(r.totalPx),r.cellsPerPage&&this._pageStore.setPageSize(r.cellsPerPage),this._pageStore.readPropertiesFromResponse(r)},e.prototype.register=function(e){var t=new n(this._handleCounter,this,e);return this._handleCounter+=1,this._callers.push(t.internal),t},e.prototype.fetchData=function(e){var t=this.createRequestDTO(e);return e.requestId=this._requestCounter,e.cancelOngoingFetch(),this._endPointFn(t)},e.prototype.createRequestDTO=function(e){var t,r=null;r=e.pxViewPort.isZero?this._pageStore.cellRangeToPageRange(e.loadPort):this._pageStore.pxRangeToPageRange(e.pxLoadPort),r=this._pageStore.limitPagesToLoad(r),t=this._pageStore.pageRangeToCellRange(r);new c;var o=(new c).init({sourceId:this._id,requestId:this._requestCounter,cellRequest:t});return this._requestCounter+=1,o},e.prototype.onDataFail=function(e,t){throw new Error("Not Implemented")},e.prototype.addDataToStream=function(e,t){if(void 0===t&&(t=!1),!this.viewPortIsAlreadyStreamed(e)||t){e.fixLoadPort();var r=this._pageStore.getLoadPort(e),o=this._pageStore.assembleDataFromPages(e),n=null;this._usePx&&(n=this.calculatePxRangeFromCellRange(r));var i=new a;i.init({totalCells:this._pageStore.totalCells,totalPx:this._pageStore.totalPx,loadPort:r,rows:o,pxScope:n}),e.stream.next(i)}},e.prototype.viewPortIsAlreadyStreamed=function(e){return!e.viewPort.isZero&&e.fixedLoadPort.contains(e.viewPort)||!e.pxViewPort.isZero&&e.fixedPxLoadPort.contains(e.pxViewPort)},e.prototype.calculatePxRangeFromCellRange=function(e){var r=new t.Rect,o=this._pageStore.getDataPagesForCellPort(e),n=(new t.Rect).fromRange2(e),i=o[0].pxScope.start.clone(),a=o[o.length-1].pxScope.stop.clone(),s=o[0].r[0].c[0].i.x,c=o[0].r[0].c[o[0].r[0].c.length-1].i.x,l=o[0].r[0].i,u=(o[o.length-1].r[o[o.length-1].r.length-1].i,t.Arr.shallowCopy(o[0].r[0].c));t.Arr.until(u,function(e,t){return t+s>=n.start.x},function(e,t){return i.x+=e.w}),t.Arr.reverse(u),t.Arr.until(u,function(e,t){return c-t>=n.start.x},function(e,t){return a.x-=e.w});var p=t.Arr.shallowCopy(o[0].r);return t.Arr.until(p,function(e,t){return t+l>=n.start.y},function(e,t){return i.y+=e.h}),t.Arr.reverse(p),t.Arr.until(p,function(e,t){return c-t>=n.start.y},function(e,t){return a.y-=e.h}),r.start=i,r.stop=a,r},e.DEFAULT_CONFIG={pageSize:new t.Vec2(10,10),retainSize:10,endPointFn:null},e}(),y=function(e,t,r,o){var n,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i<3?n(a):i>3?n(t,r,a):n(t,r))||a);return i>3&&a&&Object.defineProperty(t,r,a),a},x=function(){function e(){this._viewPort=new t.Range2,this._pxViewPort=new t.Range2,this._requestMargin=new t.Vec2(0,0),this._loadPort=new t.Range2,this._pxLoadPort=new t.Range2,this._pxRequestMargin=new t.Vec2(0,0)}return e.prototype.init=function(e,t){throw new Error("Method not implemented.")},Object.defineProperty(e.prototype,"viewPort",{get:function(){return this._viewPort},set:function(e){this._viewPort.set(e),this._loadPort=this.calculateLoadPort(this._viewPort,this._requestMargin),this._pxViewPort.zero(),this._pxLoadPort.zero()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"requestMargin",{get:function(){return this._requestMargin},set:function(e){this._requestMargin.set(e),this._loadPort=this.calculateLoadPort(this._viewPort,this._requestMargin)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pxViewPort",{get:function(){return this._pxViewPort},set:function(e){this._pxViewPort.set(e),this._pxLoadPort=this.calculateLoadPort(this._pxViewPort,this._pxRequestMargin),this._viewPort.zero(),this._loadPort.zero()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pxRequestMargin",{get:function(){return this._pxRequestMargin},set:function(e){this._pxRequestMargin.set(e),this._pxLoadPort=this.calculateLoadPort(this._pxViewPort,this._pxRequestMargin)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadPort",{get:function(){return this._loadPort},set:function(e){this._loadPort.set(e),this._pxLoadPort.zero()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pxLoadPort",{get:function(){return this._pxLoadPort},set:function(e){this._pxLoadPort.set(e),this._loadPort.zero()},enumerable:!0,configurable:!0}),e.prototype.calculateLoadPort=function(e,t){var r=e.clone();r.pos.subtract(t),r.size.add(t.clone().multiply(2));var o=r.pos.clone().invert().max({x:0,y:0});return r.pos.add(o),r.size.subtract(o),r},e=y([t.Initable],e)}();return e.DataStore=d,e.DataStoreConsumable=a,e.DataStoreRequestDto=c,e.RequestConfig=x,e}({},goodcore,BehaviorSubject);
//# sourceMappingURL=goodstore.es5.iife.min.js.map
