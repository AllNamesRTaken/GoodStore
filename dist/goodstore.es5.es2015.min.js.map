{"version":3,"file":"goodstore.es5.es2015.min.js","sources":["lib/CallerInternal.js","lib/CallerHandle.js","lib/DataStoreConsumable.js","lib/Dto/DataStoreRequestDto.js","lib/DataRow.js","lib/DataPage.js","lib/PageStore.js","lib/DataStore.js","lib/RequestConfig.js"],"sourcesContent":["import { Rect, Range2, Vec2 } from \"goodcore\";\nvar CallerInternal = (function () {\n    function CallerInternal(config, stream) {\n        this._fixedLoadPort = new Range2();\n        this._fixedPxLoadPort = new Range2();\n        this.totalCells = new Vec2(-1, -1);\n        this.totalPx = new Vec2(-1, -1);\n        this._config = config;\n        this._stream = stream;\n        this.fetchSubscription = null;\n        this.ignoreFetch = -1;\n        this.requestId = -1;\n    }\n    Object.defineProperty(CallerInternal.prototype, \"config\", {\n        get: function () {\n            return this._config;\n        },\n        set: function (v) {\n            this._config = v;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(CallerInternal.prototype, \"stream\", {\n        get: function () {\n            return this._stream;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(CallerInternal.prototype, \"loadPort\", {\n        get: function () {\n            return this.config.loadPort;\n        },\n        set: function (v) {\n            this.config.loadPort = v;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(CallerInternal.prototype, \"pxLoadPort\", {\n        get: function () {\n            return this.config.pxLoadPort;\n        },\n        set: function (v) {\n            this.config.pxLoadPort = v;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(CallerInternal.prototype, \"fixedLoadPort\", {\n        get: function () {\n            return this._fixedLoadPort;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(CallerInternal.prototype, \"fixedPxLoadPort\", {\n        get: function () {\n            return this._fixedLoadPort;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(CallerInternal.prototype, \"viewPort\", {\n        get: function () {\n            return this.config.viewPort;\n        },\n        set: function (v) {\n            if (!this.config.viewPort.equals(v)) {\n                this.ignoreOngoingFetch();\n            }\n            this.config.viewPort = v;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(CallerInternal.prototype, \"pxViewPort\", {\n        get: function () {\n            return this.config.pxViewPort;\n        },\n        set: function (v) {\n            if (!this.config.pxViewPort.equals(v)) {\n                this.ignoreOngoingFetch();\n            }\n            this.config.pxViewPort = v;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    CallerInternal.prototype.fixLoadPort = function () {\n        if (this.config.pxLoadPort.isZero) {\n            this._fixedLoadPort.set(this.config.loadPort);\n            this._fixedPxLoadPort.zero();\n        }\n        else {\n            this._fixedPxLoadPort.set(this.config.pxLoadPort);\n            this._fixedLoadPort.zero();\n        }\n    };\n    CallerInternal.prototype.ignoreOngoingFetch = function () {\n        if (this.fetchSubscription !== null) {\n            this.ignoreFetch = this.requestId;\n        }\n    };\n    CallerInternal.prototype.cancelOngoingFetch = function () {\n        if (this.fetchSubscription !== null) {\n            this.fetchSubscription.unsubscribe();\n            this.fetchSubscription = null;\n        }\n    };\n    CallerInternal.prototype.limitLoadPortByTotalCells = function () {\n        this.limitPortByTotal(this.loadPort, this.totalCells);\n    };\n    CallerInternal.prototype.limitPxLoadPortByTotalPx = function () {\n        this.limitPortByTotal(this.pxLoadPort, this.totalPx);\n    };\n    CallerInternal.prototype.limitPortByTotal = function (port, total) {\n        if (!port.isZero && !total.equals({ x: -1, y: -1 })) {\n            var overflow = new Rect().fromRange2(port).stop.subtract(total).max(new Vec2(0, 0));\n            port.size.subtract(overflow);\n        }\n    };\n    return CallerInternal;\n}());\nexport { CallerInternal };\n//# sourceMappingURL=CallerInternal.js.map","import { BehaviorSubject } from \"rxjs/BehaviorSubject\";\nimport { CallerInternal } from \"./CallerInternal\";\nvar CallerHandle = (function () {\n    function CallerHandle(id, store, config) {\n        this._force = false;\n        this._id = id;\n        this._store = store;\n        this._stream = new BehaviorSubject(null);\n        this._internal = new CallerInternal(config, this._stream);\n    }\n    Object.defineProperty(CallerHandle.prototype, \"internal\", {\n        get: function () {\n            return this._internal;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(CallerHandle.prototype, \"stream\", {\n        get: function () {\n            return this._stream;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(CallerHandle.prototype, \"viewPort\", {\n        get: function () {\n            return this._internal.viewPort;\n        },\n        set: function (v) {\n            this._internal.viewPort = v;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(CallerHandle.prototype, \"pxViewPort\", {\n        get: function () {\n            return this._internal.pxViewPort;\n        },\n        set: function (v) {\n            this._internal.pxViewPort = v;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(CallerHandle.prototype, \"requestMargin\", {\n        get: function () {\n            return this._internal.config.requestMargin;\n        },\n        set: function (v) {\n            this._internal.config.requestMargin = v;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    CallerHandle.prototype.load = function (config) {\n        this.readConfig(config);\n        this._store.load(this.internal, this._force);\n    };\n    CallerHandle.prototype.unregister = function () {\n        throw new Error(\"not implemented\");\n    };\n    CallerHandle.prototype.readConfig = function (config) {\n        if (config !== undefined) {\n            if (config.requestMargin !== undefined) {\n                this.internal.config.requestMargin = config.requestMargin;\n            }\n            if (config.viewPort !== undefined) {\n                this.viewPort = config.viewPort;\n            }\n            if (config.pxViewPort !== undefined) {\n                this.pxViewPort = config.pxViewPort;\n            }\n            this._force = config.forceStream === true;\n        }\n    };\n    return CallerHandle;\n}());\nexport { CallerHandle };\n//# sourceMappingURL=CallerHandle.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { Initable, Rect, Vec2 } from \"goodcore\";\nvar DataStoreConsumable = (function () {\n    function DataStoreConsumable() {\n        this.totalCells = new Vec2();\n        this.totalPx = new Vec2();\n        this.loadPort = null;\n        this.pxScope = new Rect();\n        this.rows = null;\n    }\n    DataStoreConsumable.prototype.init = function (obj, mapping) {\n        throw new Error(\"Method not implemented.\");\n    };\n    DataStoreConsumable = __decorate([\n        Initable\n    ], DataStoreConsumable);\n    return DataStoreConsumable;\n}());\nexport { DataStoreConsumable };\n//# sourceMappingURL=DataStoreConsumable.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { Initable } from \"goodcore\";\nvar DataStoreRequestDto = (function () {\n    function DataStoreRequestDto() {\n        this.sourceId = \"\";\n        this.requestId = 0;\n        this.cellRequest = null;\n    }\n    DataStoreRequestDto.prototype.init = function (obj, mapping) {\n        throw new Error(\"Method not implemented.\");\n    };\n    DataStoreRequestDto = __decorate([\n        Initable\n    ], DataStoreRequestDto);\n    return DataStoreRequestDto;\n}());\nexport { DataStoreRequestDto };\n//# sourceMappingURL=DataStoreRequestDto.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = (this && this.__metadata) || function (k, v) {\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nimport { Initable, Poolable } from \"goodcore\";\nvar DataRow = (function () {\n    function DataRow(length) {\n        if (length === void 0) { length = 0; }\n        this.i = 0;\n        this.h = 0;\n        this.d = null;\n        this.c = new Array(length);\n    }\n    DataRow.prototype.release = function () {\n        throw new Error(\"Method not implemented.\");\n    };\n    DataRow.prototype.initPool = function (pool) {\n        throw new Error(\"Method not implemented.\");\n    };\n    DataRow.prototype.init = function (obj, mapping) {\n        throw new Error(\"Method not implemented.\");\n    };\n    DataRow = __decorate([\n        Poolable,\n        Initable,\n        __metadata(\"design:paramtypes\", [Number])\n    ], DataRow);\n    return DataRow;\n}());\nexport { DataRow };\n//# sourceMappingURL=DataRow.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = (this && this.__metadata) || function (k, v) {\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nimport { Initable, Poolable, Rect, Vec2 } from \"goodcore\";\nimport { DataRow } from \"./DataRow\";\nvar DataPage = (function () {\n    function DataPage() {\n        this._id = 0;\n        this._r = [];\n        this._pxScope = new Rect();\n        this._cellSize = new Vec2();\n        this._r = new Array();\n    }\n    DataPage.prototype.init = function (obj, mapping) {\n        throw new Error(\"Method not implemented.\");\n    };\n    DataPage.prototype.release = function () {\n        throw new Error(\"Method not implemented.\");\n    };\n    DataPage.prototype.initPool = function (pool) {\n        throw new Error(\"Method not implemented.\");\n    };\n    Object.defineProperty(DataPage.prototype, \"id\", {\n        get: function () {\n            return this._id;\n        },\n        set: function (v) {\n            this._id = v;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DataPage.prototype, \"r\", {\n        get: function () {\n            return this._r;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DataPage.prototype, \"pxScope\", {\n        get: function () {\n            return this._pxScope;\n        },\n        set: function (v) {\n            this._pxScope.set(v);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(DataPage.prototype, \"cellSize\", {\n        get: function () {\n            return this._cellSize;\n        },\n        set: function (v) {\n            this._cellSize.set(v);\n            this.initData(v);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    DataPage.prototype.addRow = function () {\n        var result = new DataRow();\n        this._r.push(result);\n        return result;\n    };\n    DataPage.prototype.initData = function (size) {\n        var i = -1;\n        if (this._r === undefined) {\n            this._r = [];\n        }\n        var r = this._r;\n        var j = r.length - 1;\n        var k = Math.min(j, size.y);\n        while (++j < size.y) {\n            r.push(new DataRow(size.x));\n        }\n        if (r.length !== size.y) {\n            r.length = size.y;\n        }\n        while (++i < k) {\n            r[i].c.length = size.x;\n        }\n    };\n    DataPage = __decorate([\n        Poolable,\n        Initable,\n        __metadata(\"design:paramtypes\", [])\n    ], DataPage);\n    return DataPage;\n}());\nexport { DataPage };\n//# sourceMappingURL=DataPage.js.map","import { DataRow } from \"./DataRow\";\nimport { Arr, Dictionary, Pool, Range2, Rect, Util, Vec2 } from \"goodcore\";\nimport { DataPage } from \"./DataPage\";\nvar PageStore = (function () {\n    function PageStore(pageSize, retainSize, pagePxRanges) {\n        if (pagePxRanges === void 0) { pagePxRanges = null; }\n        this.isDebug = true;\n        this._usePx = true;\n        this._dummyRect = new Rect();\n        this._pagePool = new Pool(DataPage);\n        this._pageLookup = new Dictionary();\n        this._requestedPages = new Dictionary();\n        this._pageQueue = new Array();\n        this._cellsPerPage = new Vec2();\n        this._pagesPerCell = new Vec2();\n        this.setPageSize(pageSize);\n        this._retainSize = retainSize;\n        this._totalPages = new Vec2();\n        this._totalCells = new Vec2();\n        this._totalPx = new Vec2();\n        this._pagePxRanges = pagePxRanges;\n        this._usePx = pagePxRanges !== null;\n    }\n    Object.defineProperty(PageStore.prototype, \"totalPx\", {\n        get: function () {\n            return this._totalPx;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(PageStore.prototype, \"totalCells\", {\n        get: function () {\n            return this._totalCells;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(PageStore.prototype, \"totalPages\", {\n        get: function () {\n            return this._totalPages;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    PageStore.prototype.setPageSize = function (v) {\n        if (!this._cellsPerPage.equals(v)) {\n            this.emptyPageStore();\n        }\n        this._cellsPerPage.set(v);\n        this._pagesPerCell.x = 1 / v.x;\n        this._pagesPerCell.y = 1 / v.y;\n    };\n    PageStore.prototype.isRequestedDataLoaded = function (caller) {\n        var _this = this;\n        var result = false;\n        var hasLoadPort = !caller.loadPort.isZero;\n        var hasPxLoadPort = !caller.pxLoadPort.isZero;\n        if (hasLoadPort || hasPxLoadPort) {\n            var pages = hasLoadPort ?\n                this.cellRangeToPageRange(caller.loadPort) :\n                this.pxRangeToPageRange(caller.pxLoadPort);\n            result = pages.first(function (p) { return !_this._pageLookup.has(p.y * _this._totalPages.x + p.x); }) === null;\n        }\n        return result;\n    };\n    PageStore.prototype.limitPagesToLoad = function (pageRange) {\n        var result = pageRange.clone();\n        var pages = new Rect().fromRange2(pageRange);\n        var isNew = false;\n        for (var i = pages.start.y; i < pages.stop.y; i += 1) {\n            for (var j = pages.start.x; j < pages.stop.x; j += 1) {\n                if (!this._pageLookup.has(i * this._cellsPerPage.x + j)\n                    && !this._requestedPages.has(i * this._cellsPerPage.x + j)) {\n                    isNew = true;\n                    break;\n                }\n            }\n            if (isNew) {\n                break;\n            }\n            result.pos.y += 1;\n            result.size.y -= 1;\n        }\n        isNew = false;\n        for (var i = pages.stop.y; i > pages.start.y; i -= 1) {\n            for (var j = pages.start.x; j < pages.stop.x; j += 1) {\n                if (!this._pageLookup.has(i * this._cellsPerPage.x + j)\n                    && !this._requestedPages.has(i * this._cellsPerPage.x + j)) {\n                    isNew = true;\n                    break;\n                }\n            }\n            if (isNew) {\n                break;\n            }\n            result.size.y -= 1;\n        }\n        isNew = false;\n        for (var i = pages.start.x; i < pages.stop.x; i += 1) {\n            for (var j = pages.start.y; j < pages.stop.y; j += 1) {\n                if (!this._pageLookup.has(j * this._cellsPerPage.x + i)\n                    && !this._requestedPages.has(j * this._cellsPerPage.x + i)) {\n                    isNew = true;\n                    break;\n                }\n            }\n            if (isNew) {\n                break;\n            }\n            result.pos.x += 1;\n            result.size.x -= 1;\n        }\n        isNew = false;\n        for (var i = pages.stop.x; i > pages.start.x; i -= 1) {\n            for (var j = pages.start.y; j < pages.stop.y; j += 1) {\n                if (!this._pageLookup.has(j * this._cellsPerPage.x + i)\n                    && !this._requestedPages.has(j * this._cellsPerPage.x + i)) {\n                    isNew = true;\n                    break;\n                }\n            }\n            if (isNew) {\n                break;\n            }\n            result.size.x -= 1;\n        }\n        return result;\n    };\n    PageStore.prototype.cellSpaceToPageSpaceX = function (v) {\n        return (v / this._cellsPerPage.x) | 0;\n    };\n    PageStore.prototype.cellSpaceToPageSpaceY = function (v) {\n        return (v / this._cellsPerPage.y) | 0;\n    };\n    PageStore.prototype.cellSpaceToInnerPageSpaceX = function (v) {\n        return v - (this._cellsPerPage.x * this.cellSpaceToPageSpaceX(v));\n    };\n    PageStore.prototype.cellSpaceToInnerPageSpaceY = function (v) {\n        return v - (this._cellsPerPage.y * this.cellSpaceToPageSpaceY(v));\n    };\n    PageStore.prototype.pxRangeToPageRange = function (pixels) {\n        Util.assert(!!this._pagePxRanges.x && !!this._pagePxRanges.y, \"pagePxRanges does not contain valid ranges\");\n        var x1 = pixels.pos.x;\n        var pageX1 = Arr.binarySearch(this._pagePxRanges.x, function (el) {\n            return (el.p + el.s <= x1) ? -1 :\n                (el.p > x1) ? 1 :\n                    0;\n        });\n        var y1 = pixels.pos.y;\n        var pageY1 = Arr.binarySearch(this._pagePxRanges.y, function (el) {\n            return (el.p + el.s <= y1) ? -1 :\n                (el.p > y1) ? 1 :\n                    0;\n        });\n        var x2 = pixels.pos.x + pixels.size.x - 1;\n        var pageX2 = Arr.binarySearch(this._pagePxRanges.x, function (el) {\n            return (el.p + el.s <= x2) ? -1 :\n                (el.p > x2) ? 1 :\n                    0;\n        });\n        var y2 = pixels.pos.y + pixels.size.y - 1;\n        var pageY2 = Arr.binarySearch(this._pagePxRanges.y, function (el) {\n            return (el.p + el.s <= y2) ? -1 :\n                (el.p > y2) ? 1 :\n                    0;\n        });\n        var pages = new Range2().fromRect(new Rect(pageX1, pageY1, pageX2, pageY2, true));\n        return pages;\n    };\n    PageStore.prototype.cellRangeToPageRange = function (cells) {\n        var pages = new Range2().set(cells);\n        var rect = this._dummyRect.fromRange2(pages).translate(this._pagesPerCell);\n        rect.start.toInt();\n        rect.stop.ceil();\n        pages.fromRect(rect);\n        return pages;\n    };\n    PageStore.prototype.pageRangeToCellRange = function (pages) {\n        return (new Range2()).set(pages).translate(this._cellsPerPage).toInt();\n    };\n    PageStore.prototype.pxRangeToCellRange = function (pixels) {\n        var pageRange = this.pxRangeToPageRange(pixels);\n        var pages = this.getDataPagesForPageRange(pageRange);\n        var pos = pages[0].pxScope.start.clone();\n        var indexX1 = 0;\n        Arr.until(pages[0].r[0].c, function (el, i) { return pixels.pos.x < pos.x + el.w; }, function (el, i) { pos.x += el.w; ++indexX1; });\n        var indexY1 = 0;\n        Arr.until(pages[0].r, function (el, i) { return pixels.pos.y < pos.y + el.h; }, function (el, i) { pos.y += el.h; ++indexY1; });\n        pos = pages[pages.length - 1].pxScope.start.clone();\n        var indexX2 = 0;\n        Arr.until(pages[pages.length - 1].r[0].c, function (el, i) { return pixels.pos.x + pixels.size.x - 1 < pos.x + el.w; }, function (el, i) { pos.x += el.w; ++indexX2; });\n        var indexY2 = 0;\n        Arr.until(pages[pages.length - 1].r, function (el, i) { return pixels.pos.y + pixels.size.y - 1 < pos.y + el.h; }, function (el, i) { pos.y += el.h; ++indexY2; });\n        var start = pages[0].r[indexY1].c[indexX1].i;\n        var stop = pages[pages.length - 1].r[indexY2].c[indexX2].i;\n        var result = new Range2().fromRect(new Rect(start.x, start.y, stop.x, stop.y, true));\n        return result;\n    };\n    PageStore.prototype.addDataToPageStore = function (callers, payload) {\n        var _this = this;\n        var pages = this.partitionDataIntoPages(payload.r, payload.dataPort, payload.pxScope);\n        pages.forEach(function (p) { return _this.insertPage(p); });\n        this.cleanPageStore(callers);\n    };\n    PageStore.prototype.readPropertiesFromResponse = function (payload) {\n        if (!this._totalCells.equals(payload.totalCells)) {\n            this._totalPages.set(payload.totalCells).scale(this._pagesPerCell);\n            this._totalCells.set(payload.totalCells);\n            if (this._usePx) {\n                this._totalPx.set(payload.totalPx);\n            }\n        }\n    };\n    PageStore.prototype.emptyPageStore = function () {\n        while (this._pageQueue.length > 0) {\n            this.shiftPageQueue();\n        }\n    };\n    PageStore.prototype.cleanPageStore = function (callers) {\n        var _this = this;\n        var locked = this.calculateLockedPages(callers);\n        var retainCount = Math.max(this._retainSize, locked.values.length);\n        Arr.reverse(this._pageQueue);\n        Arr.reverseUntil(this._pageQueue, function (el, i) { return _this._pageQueue.length <= retainCount; }, function (el, i) {\n            if (!locked.has(\"\" + _this._pageQueue[i].id)) {\n                _this.removePageFromQueue(_this._pageQueue[i]);\n            }\n        });\n        Arr.reverse(this._pageQueue);\n    };\n    PageStore.prototype.removePageFromQueue = function (page) {\n        Arr.remove(this._pageQueue, page);\n        this.deletePageById(page.id);\n        page.release();\n    };\n    PageStore.prototype.shiftPageQueue = function () {\n        var toRemove = this._pageQueue.shift();\n        this.deletePageById(toRemove.id);\n        toRemove.release();\n    };\n    PageStore.prototype.deletePageById = function (pageId) {\n        var exists = this._pageLookup.has(pageId);\n        if (exists) {\n            this._pageLookup.delete(pageId);\n        }\n    };\n    PageStore.prototype.partitionDataIntoPages = function (data, cellPort, pxScope) {\n        var pageRect = new Rect().fromRange2(this.cellRangeToPageRange(cellPort));\n        var result = new Array();\n        var pageCountY = 0;\n        for (var pageY = pageRect.start.y; pageY < pageRect.stop.y; ++pageY) {\n            var pageCountX = 0;\n            for (var pageX = pageRect.start.x; pageX < pageRect.stop.x; ++pageX) {\n                var id = (pageY * this._totalPages.x) + pageX;\n                var isNewPage = !this._pageLookup.has(id);\n                if (isNewPage) {\n                    var dataPage = this._pagePool.get();\n                    dataPage.id = id;\n                    dataPage.cellSize = this._cellsPerPage;\n                    if (this._usePx) {\n                        var pagePxX = this._pagePxRanges.x[pageX];\n                        var pagePxY = this._pagePxRanges.y[pageY];\n                        var pagePxScope = dataPage.pxScope;\n                        pagePxScope.start.x = pagePxX.p;\n                        pagePxScope.start.y = pagePxY.p;\n                        pagePxScope.stop.x = pagePxX.p + pagePxX.s - 1;\n                        pagePxScope.stop.y = pagePxY.p + pagePxY.s - 1;\n                    }\n                    result.push(dataPage);\n                    var dataStartY = pageCountY * this._cellsPerPage.y;\n                    var dataStartX = pageCountX * this._cellsPerPage.x;\n                    var dataLimitY = dataStartY + this._cellsPerPage.y;\n                    var dataLimitX = dataStartX + this._cellsPerPage.x;\n                    var pageRowNum = 0;\n                    for (var i = dataStartY; i < dataLimitY && i < data.length; ++i) {\n                        var row = data[i];\n                        var pageRow = dataPage.r[pageRowNum];\n                        pageRow.h = row.h;\n                        pageRow.i = row.i;\n                        pageRow.d = row.d;\n                        var pageColNum = 0;\n                        for (var j = dataStartX; j < dataLimitX && j < row.c.length; ++j) {\n                            pageRow.c[pageColNum] = row.c[j];\n                            ++pageColNum;\n                        }\n                        ++pageRowNum;\n                    }\n                }\n                ++pageCountX;\n            }\n            ++pageCountY;\n        }\n        return result;\n    };\n    PageStore.prototype.insertPage = function (page) {\n        var isNew = !this._pageLookup.has(page.id);\n        if (!isNew) {\n            Arr.removeOneByFn(this._pageQueue, function (el) {\n                return el.id === page.id;\n            });\n        }\n        this._pageQueue.push(page);\n        this._pageLookup.set(page.id, page);\n    };\n    PageStore.prototype.calculateLockedPages = function (callers) {\n        var _this = this;\n        var unique = new Dictionary();\n        Arr.forEach(Arr.flatten(Arr.map(callers, function (caller) {\n            return _this.getPageIdsForViewPort(caller.loadPort);\n        })), function (id) { return unique.set(id, id); });\n        return unique;\n    };\n    PageStore.prototype.assembleDataFromPages = function (caller) {\n        var result = new Array();\n        var loadPort = this.getLoadPort(caller);\n        Util.loop(loadPort.size.y, function (i) {\n            return result.push(new DataRow(loadPort.size.x));\n        });\n        var dataPages = this.getDataPages(caller);\n        var loadRect = new Rect().fromRange2(loadPort);\n        var pageRange = this.cellRangeToPageRange(loadPort);\n        var viewSpace = new Vec2();\n        var modelSpace = new Vec2();\n        var pageSpace = new Vec2();\n        var innerPageSpace = new Vec2();\n        var dataPageNum;\n        var modelRowCount = result.length;\n        var modelColCount = result[0] === undefined ? 0 : result[0].c.length;\n        var relativePageSpace = new Vec2();\n        for (viewSpace.y = loadRect.start.y; viewSpace.y < loadRect.stop.y && modelSpace.y < modelRowCount; viewSpace.y += 1, modelSpace.y += 1) {\n            pageSpace.y = this.cellSpaceToPageSpaceY(viewSpace.y);\n            modelSpace.x = 0;\n            innerPageSpace.y = this.cellSpaceToInnerPageSpaceY(viewSpace.y);\n            relativePageSpace.set(pageSpace).subtract(pageRange.pos);\n            dataPageNum = relativePageSpace.y * pageRange.size.x + relativePageSpace.x;\n            var rowInfo = dataPages[dataPageNum].r[innerPageSpace.y];\n            result[modelSpace.y].init({ i: rowInfo.i, h: rowInfo.h, d: rowInfo.d });\n            for (viewSpace.x = loadRect.start.x; viewSpace.x < loadRect.stop.x && modelSpace.x < modelColCount; viewSpace.x += 1, modelSpace.x += 1) {\n                pageSpace.x = this.cellSpaceToPageSpaceX(viewSpace.x);\n                innerPageSpace.x = this.cellSpaceToInnerPageSpaceX(viewSpace.x);\n                innerPageSpace.y = this.cellSpaceToInnerPageSpaceY(viewSpace.y);\n                relativePageSpace.set(pageSpace).subtract(pageRange.pos);\n                dataPageNum = relativePageSpace.y * pageRange.size.x + relativePageSpace.x;\n                result[modelSpace.y].c[modelSpace.x] = dataPages[dataPageNum].r[innerPageSpace.y].c[innerPageSpace.x];\n            }\n        }\n        return result;\n    };\n    PageStore.prototype.getPageIdsForViewPort = function (viewPort) {\n        var _this = this;\n        var pages = this.cellRangeToPageRange(viewPort);\n        var result = [];\n        pages.forEach(function (p) {\n            var pos = p.y * _this._cellsPerPage.x + p.x;\n            if (_this._pageLookup.has(pos)) {\n                result.push(_this._pageLookup.get(pos).id);\n            }\n            return false;\n        });\n        return result;\n    };\n    PageStore.prototype.getLoadPort = function (caller) {\n        var byCells = !caller.loadPort.isZero;\n        return byCells ?\n            caller.loadPort :\n            this.pxRangeToCellRange(caller.pxLoadPort);\n    };\n    PageStore.prototype.getDataPages = function (caller) {\n        var byCells = !caller.loadPort.isZero;\n        return byCells ?\n            this.getDataPagesForCellPort(caller.loadPort) :\n            this.getDataPagesForPxPort(caller.pxLoadPort);\n    };\n    PageStore.prototype.getDataPagesForCellPort = function (port) {\n        var pages = this.cellRangeToPageRange(port);\n        return this.getDataPagesForPageRange(pages);\n    };\n    PageStore.prototype.getDataPagesForPxPort = function (port) {\n        var pages = this.pxRangeToPageRange(port);\n        return this.getDataPagesForPageRange(pages);\n    };\n    PageStore.prototype.getDataPagesForPageRange = function (pages) {\n        var _this = this;\n        var result = new Array();\n        pages.forEach(function (p) {\n            var pos = p.y * _this._totalPages.x + p.x;\n            if (_this._pageLookup.has(pos)) {\n                result.push(_this._pageLookup.get(pos));\n            }\n            return false;\n        });\n        return result;\n    };\n    return PageStore;\n}());\nexport { PageStore };\n//# sourceMappingURL=PageStore.js.map","import { Arr, Rect, Test, Util, Vec2 } from \"goodcore\";\nimport { CallerHandle } from \"./CallerHandle\";\nimport { DataStoreConsumable } from \"./DataStoreConsumable\";\nimport { DataStoreRequestDto } from \"./Dto/DataStoreRequestDto\";\nimport { PageStore } from \"./PageStore\";\nvar DataStore = (function () {\n    function DataStore(config) {\n        this.isDebug = true;\n        this._id = Util.newUUID();\n        this._usePx = true;\n        this._requestCounter = 0;\n        this._handleCounter = 0;\n        this._callers = [];\n        this._pageStore = null;\n        this._endPointFn = config.endPointFn ? config.endPointFn : DataStore.DEFAULT_CONFIG.endPointFn;\n        this._pageStore = new PageStore(config.pageSize || DataStore.DEFAULT_CONFIG.pageSize, config.retainSize ? config.retainSize : DataStore.DEFAULT_CONFIG.retainSize, config.pagePxRanges);\n    }\n    DataStore.prototype.load = function (caller, force) {\n        var _this = this;\n        if (force === void 0) { force = false; }\n        Util.assert(Test.isFunction(this._endPointFn), \"EndPoint is valid function\", this.isDebug);\n        Util.assert(caller.viewPort !== undefined, \"ViewPort is defined\", this.isDebug);\n        if (this.loadPortHasChanged(caller) || force) {\n            caller.limitLoadPortByTotalCells();\n            caller.limitPxLoadPortByTotalPx();\n            if (this._pageStore.isRequestedDataLoaded(caller)) {\n                this.addDataToStream(caller, force);\n                this._pageStore.cleanPageStore(this._callers);\n            }\n            else {\n                caller.fetchSubscription = this.fetchData(caller).subscribe(function (value) {\n                    if (!Util.assert(value !== undefined, \"Payload from server was empty in DataStore.load()\", _this.isDebug)) {\n                        return;\n                    }\n                    _this.readPropertiesFromResponse(caller, value);\n                    caller.limitLoadPortByTotalCells();\n                    caller.limitPxLoadPortByTotalPx();\n                    _this._pageStore.addDataToPageStore(_this._callers, value);\n                    if (caller.ignoreFetch < caller.requestId) {\n                        _this.addDataToStream(caller, force);\n                    }\n                }, function (error) {\n                    caller.cancelOngoingFetch();\n                    _this.onDataFail(caller, error);\n                });\n            }\n        }\n    };\n    DataStore.prototype.loadPortHasChanged = function (caller) {\n        var loadPort = caller.loadPort;\n        var pxLoadPort = caller.pxLoadPort;\n        return (!loadPort.isZero && !loadPort.equals(caller.fixedLoadPort)) ||\n            (!pxLoadPort.isZero && !pxLoadPort.equals(caller.fixedPxLoadPort));\n    };\n    DataStore.prototype.readPropertiesFromResponse = function (caller, value) {\n        caller.totalCells = new Vec2().set(value.totalCells);\n        this._usePx = !!value.pxScope;\n        if (this._usePx) {\n            caller.totalPx.set(value.totalPx);\n        }\n        if (value.cellsPerPage) {\n            this._pageStore.setPageSize(value.cellsPerPage);\n        }\n        this._pageStore.readPropertiesFromResponse(value);\n    };\n    DataStore.prototype.register = function (config) {\n        var result = new CallerHandle(this._handleCounter, this, config);\n        this._handleCounter += 1;\n        this._callers.push(result.internal);\n        return result;\n    };\n    DataStore.prototype.fetchData = function (caller) {\n        var dto = this.createRequestDTO(caller);\n        caller.requestId = this._requestCounter;\n        var data;\n        caller.cancelOngoingFetch();\n        return this._endPointFn(dto);\n    };\n    DataStore.prototype.createRequestDTO = function (caller) {\n        var pxRequest = null;\n        var cellRequest = null;\n        var pageRequest = null;\n        if (!caller.pxViewPort.isZero) {\n            pageRequest = this._pageStore.pxRangeToPageRange(caller.pxLoadPort);\n        }\n        else {\n            pageRequest = this._pageStore.cellRangeToPageRange(caller.loadPort);\n        }\n        pageRequest = this._pageStore.limitPagesToLoad(pageRequest);\n        cellRequest = this._pageStore.pageRangeToCellRange(pageRequest);\n        var foo = new DataStoreRequestDto();\n        var result = new DataStoreRequestDto().init({\n            sourceId: this._id,\n            requestId: this._requestCounter,\n            cellRequest: cellRequest\n        });\n        this._requestCounter += 1;\n        return result;\n    };\n    DataStore.prototype.onDataFail = function (caller, reason) {\n        throw new Error(\"Not Implemented\");\n    };\n    DataStore.prototype.addDataToStream = function (caller, force) {\n        if (force === void 0) { force = false; }\n        if (!this.viewPortIsAlreadyStreamed(caller) || force) {\n            caller.fixLoadPort();\n            var loadPort = this._pageStore.getLoadPort(caller);\n            var rows = this._pageStore.assembleDataFromPages(caller);\n            var pxScope = null;\n            if (this._usePx) {\n                pxScope = this.calculatePxRangeFromCellRange(loadPort);\n            }\n            var result = new DataStoreConsumable();\n            result.init({ totalCells: this._pageStore.totalCells, totalPx: this._pageStore.totalPx, loadPort: loadPort, rows: rows, pxScope: pxScope });\n            caller.stream.next(result);\n        }\n    };\n    DataStore.prototype.viewPortIsAlreadyStreamed = function (caller) {\n        return (!caller.viewPort.isZero && caller.fixedLoadPort.contains(caller.viewPort)) ||\n            (!caller.pxViewPort.isZero && caller.fixedPxLoadPort.contains(caller.pxViewPort));\n    };\n    DataStore.prototype.calculatePxRangeFromCellRange = function (loadPort) {\n        var result = new Rect();\n        var dataPages = this._pageStore.getDataPagesForCellPort(loadPort);\n        var loadRect = new Rect().fromRange2(loadPort);\n        var startPx = dataPages[0].pxScope.start.clone();\n        var stopPx = dataPages[dataPages.length - 1].pxScope.stop.clone();\n        var leftIndex = dataPages[0].r[0].c[0].i.x;\n        var rightIndex = dataPages[0].r[0].c[dataPages[0].r[0].c.length - 1].i.x;\n        var topIndex = dataPages[0].r[0].i;\n        var bottomIndex = dataPages[dataPages.length - 1].r[dataPages[dataPages.length - 1].r.length - 1].i;\n        var cells = Arr.shallowCopy(dataPages[0].r[0].c);\n        Arr.until(cells, function (cell, i) { return i + leftIndex >= loadRect.start.x; }, function (cell, i) { return startPx.x += cell.w; });\n        Arr.reverse(cells);\n        Arr.until(cells, function (cell, i) { return rightIndex - i >= loadRect.start.x; }, function (cell, i) { return stopPx.x -= cell.w; });\n        var rows = Arr.shallowCopy(dataPages[0].r);\n        Arr.until(rows, function (row, i) { return i + topIndex >= loadRect.start.y; }, function (row, i) { return startPx.y += row.h; });\n        Arr.reverse(rows);\n        Arr.until(rows, function (row, i) { return rightIndex - i >= loadRect.start.y; }, function (row, i) { return stopPx.y -= row.h; });\n        result.start = startPx;\n        result.stop = stopPx;\n        return result;\n    };\n    DataStore.DEFAULT_CONFIG = {\n        pageSize: new Vec2(10, 10),\n        retainSize: 10,\n        endPointFn: null\n    };\n    return DataStore;\n}());\nexport { DataStore };\n//# sourceMappingURL=DataStore.js.map","var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nimport { Initable, Range2, Vec2 } from \"goodcore\";\nvar RequestConfig = (function () {\n    function RequestConfig() {\n        this._viewPort = new Range2();\n        this._pxViewPort = new Range2();\n        this._requestMargin = new Vec2(0, 0);\n        this._loadPort = new Range2();\n        this._pxLoadPort = new Range2();\n        this._pxRequestMargin = new Vec2(0, 0);\n    }\n    RequestConfig.prototype.init = function (obj, mapping) {\n        throw new Error(\"Method not implemented.\");\n    };\n    Object.defineProperty(RequestConfig.prototype, \"viewPort\", {\n        get: function () {\n            return this._viewPort;\n        },\n        set: function (v) {\n            this._viewPort.set(v);\n            this._loadPort = this.calculateLoadPort(this._viewPort, this._requestMargin);\n            this._pxViewPort.zero();\n            this._pxLoadPort.zero();\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(RequestConfig.prototype, \"requestMargin\", {\n        get: function () {\n            return this._requestMargin;\n        },\n        set: function (v) {\n            this._requestMargin.set(v);\n            this._loadPort = this.calculateLoadPort(this._viewPort, this._requestMargin);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(RequestConfig.prototype, \"pxViewPort\", {\n        get: function () {\n            return this._pxViewPort;\n        },\n        set: function (v) {\n            this._pxViewPort.set(v);\n            this._pxLoadPort = this.calculateLoadPort(this._pxViewPort, this._pxRequestMargin);\n            this._viewPort.zero();\n            this._loadPort.zero();\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(RequestConfig.prototype, \"pxRequestMargin\", {\n        get: function () {\n            return this._pxRequestMargin;\n        },\n        set: function (v) {\n            this._pxRequestMargin.set(v);\n            this._pxLoadPort = this.calculateLoadPort(this._pxViewPort, this._pxRequestMargin);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(RequestConfig.prototype, \"loadPort\", {\n        get: function () {\n            return this._loadPort;\n        },\n        set: function (v) {\n            this._loadPort.set(v);\n            this._pxLoadPort.zero();\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(RequestConfig.prototype, \"pxLoadPort\", {\n        get: function () {\n            return this._pxLoadPort;\n        },\n        set: function (v) {\n            this._pxLoadPort.set(v);\n            this._loadPort.zero();\n        },\n        enumerable: true,\n        configurable: true\n    });\n    RequestConfig.prototype.calculateLoadPort = function (viewPort, requestMargin) {\n        var result = viewPort.clone();\n        result.pos.subtract(requestMargin);\n        result.size.add(requestMargin.clone().multiply(2));\n        var underflow = result.pos.clone().invert().max({ x: 0, y: 0 });\n        result.pos.add(underflow);\n        result.size.subtract(underflow);\n        return result;\n    };\n    RequestConfig = __decorate([\n        Initable\n    ], RequestConfig);\n    return RequestConfig;\n}());\nexport { RequestConfig };\n//# sourceMappingURL=RequestConfig.js.map"],"names":["CallerInternal","config","stream","this","_fixedLoadPort","Range2","_fixedPxLoadPort","totalCells","Vec2","totalPx","_config","_stream","fetchSubscription","ignoreFetch","requestId","Object","defineProperty","prototype","get","set","v","enumerable","configurable","loadPort","pxLoadPort","viewPort","equals","ignoreOngoingFetch","pxViewPort","fixLoadPort","isZero","zero","cancelOngoingFetch","unsubscribe","limitLoadPortByTotalCells","limitPortByTotal","limitPxLoadPortByTotalPx","port","total","x","y","overflow","Rect","fromRange2","stop","subtract","max","size","CallerHandle","id","store","_force","_id","_store","BehaviorSubject","_internal","requestMargin","load","readConfig","internal","unregister","Error","undefined","forceStream","__decorate","decorators","target","key","desc","d","c","arguments","length","r","getOwnPropertyDescriptor","Reflect","decorate","i","DataStoreConsumable","pxScope","rows","init","obj","mapping","Initable","DataStoreRequestDto","sourceId","cellRequest","__metadata","k","metadata","DataRow","h","Array","release","initPool","pool","Poolable","Number","DataPage","_r","_pxScope","_cellSize","initData","addRow","result","push","j","Math","min","PageStore","pageSize","retainSize","pagePxRanges","isDebug","_usePx","_dummyRect","_pagePool","Pool","_pageLookup","Dictionary","_requestedPages","_pageQueue","_cellsPerPage","_pagesPerCell","setPageSize","_retainSize","_totalPages","_totalCells","_totalPx","_pagePxRanges","emptyPageStore","isRequestedDataLoaded","caller","_this","hasLoadPort","hasPxLoadPort","cellRangeToPageRange","pxRangeToPageRange","first","p","has","limitPagesToLoad","pageRange","clone","pages","isNew","start","pos","cellSpaceToPageSpaceX","cellSpaceToPageSpaceY","cellSpaceToInnerPageSpaceX","cellSpaceToInnerPageSpaceY","pixels","Util","assert","x1","pageX1","Arr","binarySearch","el","s","y1","pageY1","x2","pageX2","y2","pageY2","fromRect","cells","rect","translate","toInt","ceil","pageRangeToCellRange","pxRangeToCellRange","getDataPagesForPageRange","indexX1","until","w","indexY1","indexX2","indexY2","addDataToPageStore","callers","payload","partitionDataIntoPages","dataPort","forEach","insertPage","cleanPageStore","readPropertiesFromResponse","scale","shiftPageQueue","locked","calculateLockedPages","retainCount","values","reverse","reverseUntil","removePageFromQueue","page","remove","deletePageById","toRemove","shift","pageId","delete","data","cellPort","pageRect","pageCountY","pageY","pageCountX","pageX","dataPage","cellSize","pagePxX","pagePxY","pagePxScope","dataStartY","dataStartX","dataLimitY","dataLimitX","pageRowNum","row","pageRow","pageColNum","removeOneByFn","unique","flatten","map","getPageIdsForViewPort","assembleDataFromPages","getLoadPort","loop","dataPageNum","dataPages","getDataPages","loadRect","viewSpace","modelSpace","pageSpace","innerPageSpace","modelRowCount","modelColCount","relativePageSpace","rowInfo","getDataPagesForCellPort","getDataPagesForPxPort","DataStore","newUUID","_requestCounter","_handleCounter","_callers","_pageStore","_endPointFn","endPointFn","DEFAULT_CONFIG","force","Test","isFunction","loadPortHasChanged","addDataToStream","fetchData","subscribe","value","error","onDataFail","fixedLoadPort","fixedPxLoadPort","cellsPerPage","register","dto","createRequestDTO","pageRequest","reason","viewPortIsAlreadyStreamed","calculatePxRangeFromCellRange","next","contains","startPx","stopPx","leftIndex","rightIndex","topIndex","shallowCopy","cell","RequestConfig","_viewPort","_pxViewPort","_requestMargin","_loadPort","_pxLoadPort","_pxRequestMargin","calculateLoadPort","add","multiply","underflow","invert"],"mappings":"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"}