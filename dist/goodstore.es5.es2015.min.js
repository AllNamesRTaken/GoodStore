import{Arr,Dictionary,Initable,Pool,Poolable,Range2,Rect,Test,Util,Vec2}from"goodcore";import{BehaviorSubject as BehaviorSubject$1}from"rxjs/BehaviorSubject";var CallerInternal=function(){function e(e,t){this._fixedLoadPort=new Range2,this._fixedPxLoadPort=new Range2,this.totalCells=new Vec2(-1,-1),this.totalPx=new Vec2(-1,-1),this._config=e,this._stream=t,this.fetchSubscription=null,this.ignoreFetch=-1,this.requestId=-1}return Object.defineProperty(e.prototype,"config",{get:function(){return this._config},set:function(e){this._config=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stream",{get:function(){return this._stream},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadPort",{get:function(){return this.config.loadPort},set:function(e){this.config.loadPort=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pxLoadPort",{get:function(){return this.config.pxLoadPort},set:function(e){this.config.pxLoadPort=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fixedLoadPort",{get:function(){return this._fixedLoadPort},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fixedPxLoadPort",{get:function(){return this._fixedLoadPort},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewPort",{get:function(){return this.config.viewPort},set:function(e){this.config.viewPort.equals(e)||this.ignoreOngoingFetch(),this.config.viewPort=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pxViewPort",{get:function(){return this.config.pxViewPort},set:function(e){this.config.pxViewPort.equals(e)||this.ignoreOngoingFetch(),this.config.pxViewPort=e},enumerable:!0,configurable:!0}),e.prototype.fixLoadPort=function(){this.config.pxLoadPort.isZero?(this._fixedLoadPort.set(this.config.loadPort),this._fixedPxLoadPort.zero()):(this._fixedPxLoadPort.set(this.config.pxLoadPort),this._fixedLoadPort.zero())},e.prototype.ignoreOngoingFetch=function(){null!==this.fetchSubscription&&(this.ignoreFetch=this.requestId)},e.prototype.cancelOngoingFetch=function(){null!==this.fetchSubscription&&(this.fetchSubscription.unsubscribe(),this.fetchSubscription=null)},e.prototype.limitLoadPortByTotalCells=function(){this.limitPortByTotal(this.loadPort,this.totalCells)},e.prototype.limitPxLoadPortByTotalPx=function(){this.limitPortByTotal(this.pxLoadPort,this.totalPx)},e.prototype.limitPortByTotal=function(e,t){if(!e.isZero&&!t.equals({x:-1,y:-1})){var o=e.toRect().stop.subtract(t).max(new Vec2(0,0));e.size.subtract(o)}},e}(),CallerHandle=function(){function e(e,t,o){this._force=!1,this._id=e,this._store=t,this._stream=new BehaviorSubject$1(null),this._internal=new CallerInternal(o,this._stream)}return Object.defineProperty(e.prototype,"internal",{get:function(){return this._internal},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stream",{get:function(){return this._stream},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewPort",{get:function(){return this._internal.viewPort},set:function(e){this._internal.viewPort=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pxViewPort",{get:function(){return this._internal.pxViewPort},set:function(e){this._internal.pxViewPort=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"requestMargin",{get:function(){return this._internal.config.requestMargin},set:function(e){this._internal.config.requestMargin=e},enumerable:!0,configurable:!0}),e.prototype.load=function(e){this.readConfig(e),this._store.load(this.internal,this._force)},e.prototype.unregister=function(){throw new Error("not implemented")},e.prototype.readConfig=function(e){void 0!==e&&(void 0!==e.requestMargin&&(this.internal.config.requestMargin=e.requestMargin),void 0!==e.viewPort&&(this.viewPort=e.viewPort),void 0!==e.pxViewPort&&(this.pxViewPort=e.pxViewPort),this._force=!0===e.forceStream)},e}(),__decorate=function(e,t,o,r){var n,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i<3?n(a):i>3?n(t,o,a):n(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},DataStoreConsumable=function(){function e(){this.totalCells=new Vec2,this.totalPx=new Vec2,this.loadPort=null,this.pxScope=new Rect,this.rows=null}return e.prototype.init=function(e){throw new Error("Method not implemented.")},e=__decorate([Initable],e)}(),__decorate$1=function(e,t,o,r){var n,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i<3?n(a):i>3?n(t,o,a):n(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},DataStoreRequestDto=function(){function e(){}return e.prototype.init=function(e){throw new Error("Method not implemented.")},e=__decorate$1([Initable],e)}(),__decorate$2=function(e,t,o,r){var n,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i<3?n(a):i>3?n(t,o,a):n(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},__metadata=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},DataRow=function(){function e(e){void 0===e&&(e=0),this.i=0,this.h=0,this.d=null,this.c=new Array(e)}return e.prototype.init=function(e){throw new Error("Method not implemented.")},e.prototype.release=function(){throw new Error("Method not implemented.")},e.prototype.initPool=function(e){throw new Error("Method not implemented.")},e=__decorate$2([Poolable,Initable,__metadata("design:paramtypes",[Number])],e)}(),__decorate$3=function(e,t,o,r){var n,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i<3?n(a):i>3?n(t,o,a):n(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},__metadata$1=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},DataPage=function(){function e(){this._id=0,this._r=[],this._pxScope=new Rect,this._cellSize=new Vec2,this._r=new Array}return e.prototype.release=function(){throw new Error("Method not implemented.")},e.prototype.initPool=function(e){throw new Error("Method not implemented.")},Object.defineProperty(e.prototype,"id",{get:function(){return this._id},set:function(e){this._id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"r",{get:function(){return this._r},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pxScope",{get:function(){return this._pxScope},set:function(e){this._pxScope.set(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cellSize",{get:function(){return this._cellSize},set:function(e){this._cellSize.set(e),this.initData(e)},enumerable:!0,configurable:!0}),e.prototype.addRow=function(){var e=new DataRow;return this._r.push(e),e},e.prototype.initData=function(e){var t=-1;void 0===this._r&&(this._r=[]);for(var o=this._r,r=o.length-1,n=Math.min(r,e.y);++r<e.y;)o.push(new DataRow(e.x));for(o.length!==e.y&&(o.length=e.y);++t<n;)o[t].c.length=e.x},e=__decorate$3([Poolable,Initable,__metadata$1("design:paramtypes",[])],e)}(),PageStore=function(){function e(e,t,o){void 0===o&&(o=null),this.isDebug=!0,this._usePx=!0,this._dummyRect=new Rect,this._pagePool=new Pool(DataPage),this._pageLookup=new Dictionary,this._requestedPages=new Dictionary,this._pageQueue=new Array,this._cellsPerPage=new Vec2,this._pagesPerCell=new Vec2,this.setPageSize(e),this._retainSize=t,this._totalPages=new Vec2,this._totalCells=new Vec2,this._totalPx=new Vec2,this._pagePxRanges=o,this._usePx=null!==o}return Object.defineProperty(e.prototype,"totalPx",{get:function(){return this._totalPx},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalCells",{get:function(){return this._totalCells},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"totalPages",{get:function(){return this._totalPages},enumerable:!0,configurable:!0}),e.prototype.setPageSize=function(e){this._cellsPerPage.equals(e)||this.emptyPageStore(),this._cellsPerPage.set(e),this._pagesPerCell.x=1/e.x,this._pagesPerCell.y=1/e.y},e.prototype.isRequestedDataLoaded=function(e){var t=this,o=!1,r=!e.loadPort.isZero,n=!e.pxLoadPort.isZero;(r||n)&&(o=null===(r?this.cellRangeToPageRange(e.loadPort):this.pxRangeToPageRange(e.pxLoadPort)).first(function(e){return!t._pageLookup.has(e.y*t._totalPages.x+e.x)}));return o},e.prototype.limitPagesToLoad=function(e){for(var t=e.clone(),o=e.toRect(),r=!1,n=o.start.y;n<o.stop.y;n+=1){for(var i=o.start.x;i<o.stop.x;i+=1)if(!this._pageLookup.has(n*this._cellsPerPage.x+i)&&!this._requestedPages.has(n*this._cellsPerPage.x+i)){r=!0;break}if(r)break;t.pos.y+=1,t.size.y-=1}r=!1;for(n=o.stop.y;n>o.start.y;n-=1){for(i=o.start.x;i<o.stop.x;i+=1)if(!this._pageLookup.has(n*this._cellsPerPage.x+i)&&!this._requestedPages.has(n*this._cellsPerPage.x+i)){r=!0;break}if(r)break;t.size.y-=1}r=!1;for(n=o.start.x;n<o.stop.x;n+=1){for(i=o.start.y;i<o.stop.y;i+=1)if(!this._pageLookup.has(i*this._cellsPerPage.x+n)&&!this._requestedPages.has(i*this._cellsPerPage.x+n)){r=!0;break}if(r)break;t.pos.x+=1,t.size.x-=1}r=!1;for(n=o.stop.x;n>o.start.x;n-=1){for(i=o.start.y;i<o.stop.y;i+=1)if(!this._pageLookup.has(i*this._cellsPerPage.x+n)&&!this._requestedPages.has(i*this._cellsPerPage.x+n)){r=!0;break}if(r)break;t.size.x-=1}return t},e.prototype.cellSpaceToPageSpaceX=function(e){return e/this._cellsPerPage.x|0},e.prototype.cellSpaceToPageSpaceY=function(e){return e/this._cellsPerPage.y|0},e.prototype.cellSpaceToInnerPageSpaceX=function(e){return e-this._cellsPerPage.x*this.cellSpaceToPageSpaceX(e)},e.prototype.cellSpaceToInnerPageSpaceY=function(e){return e-this._cellsPerPage.y*this.cellSpaceToPageSpaceY(e)},e.prototype.pxRangeToPageRange=function(e){Util.assert(!!this._pagePxRanges.x&&!!this._pagePxRanges.y,"pagePxRanges does not contain valid ranges");var t=e.pos.x,o=Arr.binarySearch(this._pagePxRanges.x,function(e){return e.p+e.s<=t?-1:e.p>t?1:0}),r=e.pos.y,n=Arr.binarySearch(this._pagePxRanges.y,function(e){return e.p+e.s<=r?-1:e.p>r?1:0}),i=e.pos.x+e.size.x-1,a=Arr.binarySearch(this._pagePxRanges.x,function(e){return e.p+e.s<=i?-1:e.p>i?1:0}),s=e.pos.y+e.size.y-1,l=Arr.binarySearch(this._pagePxRanges.y,function(e){return e.p+e.s<=s?-1:e.p>s?1:0});return new Rect(o,n,a,l,!0).toRange2()},e.prototype.cellRangeToPageRange=function(e){var t=(new Range2).set(e),o=t.toRect(!1,this._dummyRect).translate(this._pagesPerCell);return o.start.toInt(),o.stop.ceil(),o.toRange2(t),t},e.prototype.pageRangeToCellRange=function(e){return(new Range2).set(e).translate(this._cellsPerPage).toInt()},e.prototype.pxRangeToCellRange=function(e){var t=this.pxRangeToPageRange(e),o=this.getDataPagesForPageRange(t),r=o[0].pxScope.start.clone(),n=0;Arr.until(o[0].r[0].c,function(t,o){return e.pos.x<r.x+t.w},function(e,t){r.x+=e.w,++n});var i=0;Arr.until(o[0].r,function(t,o){return e.pos.y<r.y+t.h},function(e,t){r.y+=e.h,++i}),r=o[o.length-1].pxScope.start.clone();var a=0;Arr.until(o[o.length-1].r[0].c,function(t,o){return e.pos.x+e.size.x-1<r.x+t.w},function(e,t){r.x+=e.w,++a});var s=0;Arr.until(o[o.length-1].r,function(t,o){return e.pos.y+e.size.y-1<r.y+t.h},function(e,t){r.y+=e.h,++s});var l=o[0].r[i].c[n].i,c=o[o.length-1].r[s].c[a].i;return new Rect(l.x,l.y,c.x,c.y,!0).toRange2()},e.prototype.addDataToPageStore=function(e,t){var o=this;this.partitionDataIntoPages(t.r,t.dataPort,t.pxScope).forEach(function(e){return o.insertPage(e)}),this.cleanPageStore(e)},e.prototype.readPropertiesFromResponse=function(e){this._totalCells.equals(e.totalCells)||(this._totalPages.set(e.totalCells).scale(this._pagesPerCell),this._totalCells.set(e.totalCells),this._usePx&&this._totalPx.set(e.totalPx))},e.prototype.emptyPageStore=function(){for(;this._pageQueue.length>0;)this.shiftPageQueue()},e.prototype.cleanPageStore=function(e){var t=this,o=this.calculateLockedPages(e),r=Math.max(this._retainSize,o.list.count);Arr.reverse(this._pageQueue),Arr.reverseUntil(this._pageQueue,function(e,o){return t._pageQueue.length<=r},function(e,r){o.has(""+t._pageQueue[r].id)||t.removePageFromQueue(t._pageQueue[r])}),Arr.reverse(this._pageQueue)},e.prototype.removePageFromQueue=function(e){Arr.remove(this._pageQueue,e),this.deletePageById(e.id),e.release()},e.prototype.shiftPageQueue=function(){var e=this._pageQueue.shift();this.deletePageById(e.id),e.release()},e.prototype.deletePageById=function(e){this._pageLookup.has(e)&&this._pageLookup.delete(e)},e.prototype.partitionDataIntoPages=function(e,t,o){for(var r=this.cellRangeToPageRange(t).toRect(),n=new Array,i=0,a=r.start.y;a<r.stop.y;++a){for(var s=0,l=r.start.x;l<r.stop.x;++l){var c=a*this._totalPages.x+l;if(!this._pageLookup.has(c)){var u=this._pagePool.get();if(u.id=c,u.cellSize=this._cellsPerPage,this._usePx){var p=this._pagePxRanges.x[l],h=this._pagePxRanges.y[a],g=u.pxScope;g.start.x=p.p,g.start.y=h.p,g.stop.x=p.p+p.s-1,g.stop.y=h.p+h.s-1}n.push(u);for(var P=i*this._cellsPerPage.y,f=s*this._cellsPerPage.x,d=P+this._cellsPerPage.y,y=f+this._cellsPerPage.x,_=0,x=P;x<d&&x<e.length;++x){var b=e[x],w=u.r[_];w.h=b.h,w.i=b.i,w.d=b.d;for(var R=0,m=f;m<y&&m<b.c.length;++m)w.c[R]=b.c[m],++R;++_}}++s}++i}return n},e.prototype.insertPage=function(e){!this._pageLookup.has(e.id)||Arr.removeOneByFn(this._pageQueue,function(t){return t.id===e.id}),this._pageQueue.push(e),this._pageLookup.set(e.id,e)},e.prototype.calculateLockedPages=function(e){var t=this,o=new Dictionary;return Arr.forEach(Arr.flatten(Arr.map(e,function(e){return t.getPageIdsForViewPort(e.loadPort)})),function(e){return o.set(e,e)}),o},e.prototype.assembleDataFromPages=function(e){var t=new Array,o=this.getLoadPort(e);Util.loop(o.size.y,function(e){return t.push(new DataRow(o.size.x))});var r,n=this.getDataPages(e),i=o.toRect(),a=this.cellRangeToPageRange(o),s=new Vec2,l=new Vec2,c=new Vec2,u=new Vec2,p=t.length,h=void 0===t[0]?0:t[0].c.length,g=new Vec2;for(s.y=i.start.y;s.y<i.stop.y&&l.y<p;s.y+=1,l.y+=1){c.y=this.cellSpaceToPageSpaceY(s.y),l.x=0,u.y=this.cellSpaceToInnerPageSpaceY(s.y),g.set(c).subtract(a.pos);var P=n[r=g.y*a.size.x+g.x].r[u.y];for(t[l.y].init({i:P.i,h:P.h,d:P.d}),s.x=i.start.x;s.x<i.stop.x&&l.x<h;s.x+=1,l.x+=1)c.x=this.cellSpaceToPageSpaceX(s.x),u.x=this.cellSpaceToInnerPageSpaceX(s.x),u.y=this.cellSpaceToInnerPageSpaceY(s.y),g.set(c).subtract(a.pos),r=g.y*a.size.x+g.x,t[l.y].c[l.x]=n[r].r[u.y].c[u.x]}return t},e.prototype.getPageIdsForViewPort=function(e){var t=this,o=[];return this.cellRangeToPageRange(e).forEach(function(e){var r=e.y*t._cellsPerPage.x+e.x;return t._pageLookup.has(r)&&o.push(t._pageLookup.get(r).id),!1}),o},e.prototype.getLoadPort=function(e){return!e.loadPort.isZero?e.loadPort:this.pxRangeToCellRange(e.pxLoadPort)},e.prototype.getDataPages=function(e){return!e.loadPort.isZero?this.getDataPagesForCellPort(e.loadPort):this.getDataPagesForPxPort(e.pxLoadPort)},e.prototype.getDataPagesForCellPort=function(e){var t=this.cellRangeToPageRange(e);return this.getDataPagesForPageRange(t)},e.prototype.getDataPagesForPxPort=function(e){var t=this.pxRangeToPageRange(e);return this.getDataPagesForPageRange(t)},e.prototype.getDataPagesForPageRange=function(e){var t=this,o=new Array;return e.forEach(function(e){var r=e.y*t._totalPages.x+e.x;return t._pageLookup.has(r)&&o.push(t._pageLookup.get(r)),!1}),o},e}(),DataStore=function(){function e(t){this.isDebug=!0,this._id=Util.newUUID(),this._usePx=!0,this._requestCounter=0,this._handleCounter=0,this._callers=[],this._pageStore=null,this._endPointFn=t.endPointFn?t.endPointFn:e.DEFAULT_CONFIG.endPointFn,this._pageStore=new PageStore(t.pageSize||e.DEFAULT_CONFIG.pageSize,t.retainSize?t.retainSize:e.DEFAULT_CONFIG.retainSize,t.pagePxRanges)}return e.prototype.load=function(e,t){var o=this;void 0===t&&(t=!1),Util.assert(Test.isFunction(this._endPointFn),"EndPoint is valid function",this.isDebug),Util.assert(void 0!==e.viewPort,"ViewPort is defined",this.isDebug),(this.loadPortHasChanged(e)||t)&&(e.limitLoadPortByTotalCells(),e.limitPxLoadPortByTotalPx(),this._pageStore.isRequestedDataLoaded(e)?(this.addDataToStream(e,t),this._pageStore.cleanPageStore(this._callers)):e.fetchSubscription=this.fetchData(e).subscribe(function(r){Util.assert(void 0!==r,"Payload from server was empty in DataStore.load()",o.isDebug)&&(o.readPropertiesFromResponse(e,r),e.limitLoadPortByTotalCells(),e.limitPxLoadPortByTotalPx(),o._pageStore.addDataToPageStore(o._callers,r),e.ignoreFetch<e.requestId&&o.addDataToStream(e,t))},function(t){e.cancelOngoingFetch(),o.onDataFail(e,t)}))},e.prototype.loadPortHasChanged=function(e){var t=e.loadPort,o=e.pxLoadPort;return!t.isZero&&!t.equals(e.fixedLoadPort)||!o.isZero&&!o.equals(e.fixedPxLoadPort)},e.prototype.readPropertiesFromResponse=function(e,t){e.totalCells=(new Vec2).set(t.totalCells),this._usePx=!!t.pxScope,this._usePx&&e.totalPx.set(t.totalPx),t.cellsPerPage&&this._pageStore.setPageSize(t.cellsPerPage),this._pageStore.readPropertiesFromResponse(t)},e.prototype.register=function(e){var t=new CallerHandle(this._handleCounter,this,e);return this._handleCounter+=1,this._callers.push(t.internal),t},e.prototype.fetchData=function(e){var t=this.createRequestDTO(e);return e.requestId=this._requestCounter,e.cancelOngoingFetch(),this._endPointFn(t)},e.prototype.createRequestDTO=function(e){var t,o=null;o=e.pxViewPort.isZero?this._pageStore.cellRangeToPageRange(e.loadPort):this._pageStore.pxRangeToPageRange(e.pxLoadPort),o=this._pageStore.limitPagesToLoad(o),t=this._pageStore.pageRangeToCellRange(o);var r=(new DataStoreRequestDto).init({sourceId:this._id,requestId:this._requestCounter,cellRequest:t});return this._requestCounter+=1,r},e.prototype.onDataFail=function(e,t){throw new Error("Not Implemented")},e.prototype.addDataToStream=function(e,t){if(void 0===t&&(t=!1),!this.viewPortIsAlreadyStreamed(e)||t){e.fixLoadPort();var o=this._pageStore.getLoadPort(e),r=this._pageStore.assembleDataFromPages(e),n=null;this._usePx&&(n=this.calculatePxRangeFromCellRange(o));var i=new DataStoreConsumable;i.init({totalCells:this._pageStore.totalCells,totalPx:this._pageStore.totalPx,loadPort:o,rows:r,pxScope:n}),e.stream.next(i)}},e.prototype.viewPortIsAlreadyStreamed=function(e){return!e.viewPort.isZero&&e.fixedLoadPort.contains(e.viewPort)||!e.pxViewPort.isZero&&e.fixedPxLoadPort.contains(e.pxViewPort)},e.prototype.calculatePxRangeFromCellRange=function(e){var t=new Rect,o=this._pageStore.getDataPagesForCellPort(e),r=e.toRect(),n=o[0].pxScope.start.clone(),i=o[o.length-1].pxScope.stop.clone(),a=o[0].r[0].c[0].i.x,s=o[0].r[0].c[o[0].r[0].c.length-1].i.x,l=o[0].r[0].i,c=(o[o.length-1].r[o[o.length-1].r.length-1].i,Arr.shallowCopy(o[0].r[0].c));Arr.until(c,function(e,t){return t+a>=r.start.x},function(e,t){return n.x+=e.w}),Arr.reverse(c),Arr.until(c,function(e,t){return s-t>=r.start.x},function(e,t){return i.x-=e.w});var u=Arr.shallowCopy(o[0].r);return Arr.until(u,function(e,t){return t+l>=r.start.y},function(e,t){return n.y+=e.h}),Arr.reverse(u),Arr.until(u,function(e,t){return s-t>=r.start.y},function(e,t){return i.y-=e.h}),t.start=n,t.stop=i,t},e.DEFAULT_CONFIG={pageSize:new Vec2(10,10),retainSize:10,endPointFn:null},e}(),__decorate$4=function(e,t,o,r){var n,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,r);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(i<3?n(a):i>3?n(t,o,a):n(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},RequestConfig=function(){function e(){this._viewPort=new Range2,this._pxViewPort=new Range2,this._requestMargin=new Vec2(0,0),this._loadPort=new Range2,this._pxLoadPort=new Range2,this._pxRequestMargin=new Vec2(0,0)}return e.prototype.init=function(e){throw new Error("Method not implemented.")},Object.defineProperty(e.prototype,"viewPort",{get:function(){return this._viewPort},set:function(e){this._viewPort.set(e),this._loadPort=this.calculateLoadPort(this._viewPort,this._requestMargin),this._pxViewPort.zero(),this._pxLoadPort.zero()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"requestMargin",{get:function(){return this._requestMargin},set:function(e){this._requestMargin.set(e),this._loadPort=this.calculateLoadPort(this._viewPort,this._requestMargin)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pxViewPort",{get:function(){return this._pxViewPort},set:function(e){this._pxViewPort.set(e),this._pxLoadPort=this.calculateLoadPort(this._pxViewPort,this._pxRequestMargin),this._viewPort.zero(),this._loadPort.zero()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pxRequestMargin",{get:function(){return this._pxRequestMargin},set:function(e){this._pxRequestMargin.set(e),this._pxLoadPort=this.calculateLoadPort(this._pxViewPort,this._pxRequestMargin)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loadPort",{get:function(){return this._loadPort},set:function(e){this._loadPort.set(e),this._pxLoadPort.zero()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pxLoadPort",{get:function(){return this._pxLoadPort},set:function(e){this._pxLoadPort.set(e),this._loadPort.zero()},enumerable:!0,configurable:!0}),e.prototype.calculateLoadPort=function(e,t){var o=e.clone();o.pos.subtract(t),o.size.add(t.clone().multiply(2));var r=o.pos.clone().invert().max({x:0,y:0});return o.pos.add(r),o.size.subtract(r),o},e=__decorate$4([Initable],e)}();export{DataStore,DataStoreConsumable,DataStoreRequestDto,RequestConfig};
//# sourceMappingURL=goodstore.es5.es2015.min.js.map
